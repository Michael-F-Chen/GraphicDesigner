function GDLinker(a){this.src=a,this.linkDelegate=a.linkend.data("ownerCt"),this.paper=this.linkDelegate.view.set.paper,this.linkPadding=30,this.mid=function(a,b){return Math.floor((a+b)/2)},this.dasharray="",this.getTopSPoints=function(a,b,c){var d=this.linkPadding,e=[],f=Math.abs(b.x-a.x),g=Math.abs(b.y-a.y);if(b.y<a.y){if(g>=f){var h=this.mid(b.y,a.y);e.push([a.x,h],[b.x,h])}else e.push([a.x,b.y]);return e}if(e.push([a.x,a.y-d]),b.y>=a.y&&b.y<c.y2&&(b.x<=c.x||b.x>=c.x2)){if(b.x>c.x-d&&b.x<c.x2+d){var i=b.x<=c.x?c.x-d:c.x2+d;e.push([i,e.last()[1]]),g>f?e.push([i,b.y-d],[b.x,b.y-d]):e.push([i,b.y])}else if(g>f)e.push([b.x,e.last()[1]]);else{var i=b.x<c.x?b.x+d:b.x-d;e.push([i,e.last()[1]],[i,b.y])}return e}return b.x>c.x&&b.x<c.x2&&b.y>=c.y&&b.y<c.y2?(e.push([b.x<a.x?c.x-d:c.x2+d,a.y-d]),g>f?(e.push([e.last()[0],b.y-d]),e.push([b.x,b.y-d])):e.push([e.last()[0],b.y]),e):b.x>=c.x-d&&b.x<=c.x2+d&&b.y>=c.y2?(e.push([b.x<a.x?c.x-d:c.x2+d,e.last()[1]]),b.y==c.y2?e.push([e.last()[0],b.y+d],[b.x,b.y+d]):e.push([e.last()[0],b.y-d],[b.x,b.y-d]),e):(g>f?e.push([b.x,e.last()[1]]):(e.push([b.x<a.x?b.x+d:b.x-d,e.last()[1]]),e.push([e.last()[0],b.y])),e)},this.getTopSTPoints=function(a,b,c,d){var e=this.linkPadding,f=[];if("t"==b.dir)return b.y<=a.y?(d.x2<=a.x-e||d.x>=a.x+e?f.push([a.x,b.y-e],[b.x,b.y-e]):(f.push([a.x,a.y-e]),b.x<a.x?f.push([d.x2+e,f.last()[1]],[d.x2+e,b.y-e]):f.push([d.x-e,f.last()[1]],[d.x-e,b.y-e]),f.push([b.x,b.y-e])),f):(f.push([a.x,a.y-e]),b.x<=c.x-e||b.x>=c.x2+e?f.push([b.x,f.last()[1]]):(b.x<a.x?f.push([c.x-e,f.last()[1]]):f.push([c.x2+e,f.last()[1]]),f.push([f.last()[0],b.y-e],[b.x,b.y-e])),f);if("b"==b.dir){if(b.y<=a.y){var g=this.mid(a.y,b.y);return f.push([a.x,g],[b.x,g]),f}f.push([a.x,a.y-e]);var h;return d.x2<c.x?h=this.mid(d.x2,c.x):d.x>c.x2?h=this.mid(d.x,c.x2):(f.last()[1]=Math.min(a.y-e,d.y-e),h=b.x<a.x?Math.min(c.x-e,d.x-e):Math.max(c.x2+e,d.x2+e)),f.push([h,f.last()[1]],[h,b.y+e]),f.push([b.x,f.last()[1]]),f}if("l"==b.dir){if(d.y2<a.y){if(b.x<a.x){var g=this.mid(d.y2,a.y);f.push([a.x,g],[d.x-e,g],[d.x-e,b.y])}else f.push([a.x,b.y]);return f}if(b.y<a.y&&b.x>=a.x)return f.push([a.x,b.y]),f;if(f.push([a.x,Math.min(a.y-e,d.y-e)]),d.x<=c.x2)f.push([Math.min(c.x-e,d.x-e),f.last()[1]]),f.push([f.last()[0],b.y]);else{var h=this.mid(c.x2,d.x);f.push([h,f.last()[1]],[h,b.y])}}if("r"==b.dir){if(d.y2<a.y){if(b.x>a.x){var g=this.mid(d.y2,a.y);f.push([a.x,g],[d.x2+e,g],[d.x2+e,b.y])}else f.push([a.x,b.y]);return f}if(b.y<a.y&&b.x<=a.x)return f.push([a.x,b.y]),f;if(f.push([a.x,Math.min(a.y-e,d.y-e)]),d.x2>=c.x)f.push([Math.max(c.x2+e,d.x2+e),f.last()[1]]),f.push([f.last()[0],b.y]);else{var h=this.mid(c.x,d.x2);f.push([h,f.last()[1]],[h,b.y])}}return f},this.getBottomSPoints=function(a,b,c){var d=this.linkPadding,e=[],f=Math.abs(b.x-a.x),g=Math.abs(b.y-a.y);if(b.y>a.y){if(g>=f){var h=this.mid(b.y,a.y);e.push([a.x,h],[b.x,h])}else e.push([a.x,b.y]);return e}if(e.push([a.x,a.y+d]),b.y<=a.y&&b.y>c.y&&(b.x<=c.x||b.x>=c.x2)){if(b.x>c.x-d&&b.x<c.x2+d){var i=b.x<=c.x?c.x-d:c.x2+d;e.push([i,e.last()[1]]),g>f?e.push([i,b.y+d],[b.x,b.y+d]):e.push([i,b.y])}else if(g>f)e.push([b.x,e.last()[1]]);else{var i=b.x<c.x?b.x+d:b.x-d;e.push([i,e.last()[1]],[i,b.y])}return e}return b.x>c.x&&b.x<c.x2&&b.y>c.y&&b.y<=c.y2?(e.push([b.x<a.x?c.x-d:c.x2+d,a.y+d]),g>f?(e.push([e.last()[0],b.y+d]),e.push([b.x,b.y+d])):e.push([e.last()[0],b.y]),e):b.x>=c.x-d&&b.x<=c.x2+d&&b.y<=c.y?(e.push([b.x<a.x?c.x-d:c.x2+d,e.last()[1]]),b.y==c.y?e.push([e.last()[0],b.y-d],[b.x,b.y-d]):e.push([e.last()[0],b.y+d],[b.x,b.y+d]),e):(g>f?e.push([b.x,e.last()[1]]):(e.push([b.x<a.x?b.x+d:b.x-d,e.last()[1]]),e.push([e.last()[0],b.y])),e)},this.getBottomSTPoints=function(a,b,c,d){var e=this.linkPadding,f=[];if("b"==b.dir)return b.y>=a.y?(d.x2<=a.x-e||d.x>=a.x+e?f.push([a.x,b.y+e],[b.x,b.y+e]):(f.push([a.x,a.y+e]),b.x<a.x?f.push([d.x2+e,f.last()[1]],[d.x2+e,b.y+e]):f.push([d.x-e,f.last()[1]],[d.x-e,b.y+e]),f.push([b.x,b.y+e])),f):(f.push([a.x,a.y+e]),b.x<=c.x-e||b.x>=c.x2+e?f.push([b.x,f.last()[1]]):(b.x<a.x?f.push([c.x-e,f.last()[1]]):f.push([c.x2+e,f.last()[1]]),f.push([f.last()[0],b.y+e],[b.x,b.y+e])),f);if("t"==b.dir){if(b.y>=a.y){var g=this.mid(a.y,b.y);return f.push([a.x,g],[b.x,g]),f}f.push([a.x,a.y+e]);var h;return d.x2<c.x?h=this.mid(d.x2,c.x):d.x>c.x2?h=this.mid(d.x,c.x2):(f.last()[1]=Math.max(a.y+e,d.y2+e),h=b.x<a.x?Math.min(c.x-e,d.x-e):Math.max(c.x2+e,d.x2+e)),f.push([h,f.last()[1]],[h,b.y-e]),f.push([b.x,f.last()[1]]),f}if("l"==b.dir){if(d.y>a.y){if(b.x<a.x){var g=this.mid(d.y,a.y);f.push([a.x,g],[d.x-e,g],[d.x-e,b.y])}else f.push([a.x,b.y]);return f}if(b.y>a.y&&b.x>=a.x)return f.push([a.x,b.y]),f;if(f.push([a.x,Math.max(a.y+e,d.y2+e)]),d.x<=c.x2)f.push([Math.min(c.x-e,d.x-e),f.last()[1]]),f.push([f.last()[0],b.y]);else{var h=this.mid(c.x2,d.x);f.push([h,f.last()[1]],[h,b.y])}}if("r"==b.dir){if(d.y>a.y){if(b.x>a.x){var g=this.mid(d.y,a.y);f.push([a.x,g],[d.x2+e,g],[d.x2+e,b.y])}else f.push([a.x,b.y]);return f}if(b.y>a.y&&b.x<=a.x)return f.push([a.x,b.y]),f;if(f.push([a.x,Math.max(a.y+e,d.y2+e)]),d.x2>=c.x)f.push([Math.max(c.x2+e,d.x2+e),f.last()[1]]),f.push([f.last()[0],b.y]);else{var h=this.mid(c.x,d.x2);f.push([h,f.last()[1]],[h,b.y])}}return f},this.getLeftSPoints=function(a,b,c){var d=this.linkPadding,e=[],f=Math.abs(b.x-a.x),g=Math.abs(b.y-a.y);if(b.x<a.x){if(f>=g){var h=this.mid(b.x,a.x);e.push([h,a.y],[h,b.y])}else e.push([b.x,a.y]);return e}if(e.push([a.x-d,a.y]),b.x>=a.x&&b.x<c.x2&&(b.y<=c.y||b.y>=c.y2)){if(b.y>c.y-d&&b.y<c.y2+d){var i=b.y<=c.y?c.y-d:c.y2+d;e.push([e.last()[0],i]),f>g?e.push([b.x-d,i],[b.x-d,b.y]):e.push([b.x,i])}else if(f>g)e.push([e.last()[0],b.y]);else{var i=b.y<c.y?b.y+d:b.y-d;e.push([e.last()[0],i],[b.x,i])}return e}return b.x>=c.x&&b.x<c.x2&&b.y>c.y&&b.y<c.y2?(e.push([a.x-d,b.y<a.y?c.y-d:c.y2+d]),f>g?(e.push([b.x-d,e.last()[1]]),e.push([b.x-d,b.y])):e.push([b.x,e.last()[1]]),e):b.y>=c.y-d&&b.y<=c.y2+d&&b.x>=c.x2?(e.push([e.last()[0],b.y<a.y?c.y-d:c.y2+d]),b.x==c.x2?e.push([b.x+d,e.last()[1]],[b.x+d,b.y]):e.push([b.x-d,e.last()[1]],[b.x-d,b.y]),e):(f>g?e.push([e.last()[0],b.y]):(e.push([e.last()[0],b.y<a.y?b.y+d:b.y-d]),e.push([b.x,e.last()[1]])),e)},this.getLeftSTPoints=function(a,b,c,d){var e=this.linkPadding,f=[];if("l"==b.dir)return b.x<=a.x?(d.y>=a.y+e||d.y2<=a.y-e?f.push([b.x-e,a.y],[b.x-e,b.y]):(f.push([a.x-e,a.y]),b.y>a.y?f.push([f.last()[0],d.y-e],[b.x-e,d.y-e]):f.push([f.last()[0],d.y2+e],[b.x-e,d.y2+e]),f.push([b.x-e,b.y])),f):(f.push([a.x-e,a.y]),b.y<=c.y-e||b.y>=c.y2+e?f.push([f.last()[0],b.y]):(b.y>a.y?f.push([f.last()[0],c.y2+e]):f.push([f.last()[0],c.y-e]),f.push([b.x-e,f.last()[1]],[b.x-e,b.y])),f);if("r"==b.dir){if(b.x<=a.x){var g=this.mid(a.x,b.x);return f.push([g,a.y],[g,b.y]),f}f.push([a.x-e,a.y]);var h;return d.y>c.y2?h=this.mid(d.y,c.y2):d.y2<c.y?h=this.mid(d.y2,c.y):(f.last()[0]=Math.min(a.x-e,d.x-e),h=b.y>a.y?Math.max(c.y2+e,d.y2+e):Math.min(c.y-e,d.y-e)),f.push([f.last()[0],h],[b.x+e,h]),f.push([f.last()[0],b.y]),f}if("b"==b.dir){if(d.x2<a.x){if(b.y>a.y){var g=this.mid(d.x2,a.x);f.push([g,a.y],[g,d.y2+e],[b.x,d.y2+e])}else f.push([b.x,a.y]);return f}if(b.x<a.x&&b.y<=a.y)return f.push([b.x,a.y]),f;if(f.push([Math.min(a.x-e,d.x-e),a.y]),d.y2>=c.y)f.push([f.last()[0],Math.max(c.y2+e,d.y2+e)]),f.push([b.x,f.last()[1]]);else{var h=this.mid(c.y2,d.y);f.push([f.last()[0],h],[b.x,h])}}if("t"==b.dir){if(d.x2<a.x){if(b.y<a.y){var g=this.mid(d.x2,a.x);f.push([g,a.y],[g,d.y-e],[b.x,d.y-e])}else f.push([b.x,a.y]);return f}if(b.x<a.x&&b.y>=a.y)return f.push([b.x,a.y]),f;if(f.push([Math.min(a.x-e,d.x-e),a.y]),d.y<=c.y2)f.push([f.last()[0],Math.min(c.y-e,d.y-e)]),f.push([b.x,f.last()[1]]);else{var h=this.mid(c.y2,d.y);f.push([f.last()[0],h],[b.x,h])}}return f},this.getRightSPoints=function(a,b,c){var d=this.linkPadding,e=[],f=Math.abs(b.x-a.x),g=Math.abs(b.y-a.y);if(b.x>a.x){if(f>=g){var h=this.mid(b.x,a.x);e.push([h,a.y],[h,b.y])}else e.push([b.x,a.y]);return e}if(e.push([a.x+d,a.y]),b.x<=a.x&&b.x>c.x&&(b.y<=c.y||b.y>=c.y2)){if(b.y>c.y-d&&b.y<c.y2+d){var i=b.y<=c.y?c.y-d:c.y2+d;e.push([e.last()[0],i]),f>g?e.push([b.x+d,i],[b.x+d,b.y]):e.push([b.x,i])}else if(f>g)e.push([e.last()[0],b.y]);else{var i=b.y<c.y?b.y+d:b.y-d;e.push([e.last()[0],i],[b.x,i])}return e}return b.x>c.x&&b.x<=c.x2&&b.y>c.y&&b.y<c.y2?(e.push([a.x+d,b.y<a.y?c.y-d:c.y2+d]),f>g?(e.push([b.x+d,e.last()[1]]),e.push([b.x+d,b.y])):e.push([b.x,e.last()[1]]),e):b.y>=c.y-d&&b.y<=c.y2+d&&b.x<=c.x?(e.push([e.last()[0],b.y<a.y?c.y-d:c.y2+d]),b.x==c.x?e.push([b.x-d,e.last()[1]],[b.x-d,b.y]):e.push([b.x+d,e.last()[1]],[b.x+d,b.y]),e):(f>g?e.push([e.last()[0],b.y]):(e.push([e.last()[0],b.y<a.y?b.y+d:b.y-d]),e.push([b.x,e.last()[1]])),e)},this.getRightSTPoints=function(a,b,c,d){var e=this.linkPadding,f=[];if("r"==b.dir)return b.x>=a.x?(d.y>=a.y+e||d.y2<=a.y-e?f.push([b.x+e,a.y],[b.x+e,b.y]):(f.push([a.x+e,a.y]),b.y>a.y?f.push([f.last()[0],d.y-e],[b.x+e,d.y-e]):f.push([f.last()[0],d.y2+e],[b.x+e,d.y2+e]),f.push([b.x+e,b.y])),f):(f.push([a.x+e,a.y]),b.y<=c.y-e||b.y>=c.y2+e?f.push([f.last()[0],b.y]):(b.y>a.y?f.push([f.last()[0],c.y2+e]):f.push([f.last()[0],c.y-e]),f.push([b.x+e,f.last()[1]],[b.x+e,b.y])),f);if("l"==b.dir){if(b.x>=a.x){var g=this.mid(a.x,b.x);return f.push([g,a.y],[g,b.y]),f}f.push([a.x+e,a.y]);var h;return d.y>c.y2?h=this.mid(d.y,c.y2):d.y2<c.y?h=this.mid(d.y2,c.y):(f.last()[0]=Math.max(a.x+e,d.x+e),h=b.y>a.y?Math.max(c.y2+e,d.y2+e):Math.min(c.y-e,d.y-e)),f.push([f.last()[0],h],[b.x-e,h]),f.push([f.last()[0],b.y]),f}if("t"==b.dir){if(d.x>a.x){if(b.y<a.y){var g=this.mid(d.x,a.x);f.push([g,a.y],[g,d.y-e],[b.x,d.y-e])}else f.push([b.x,a.y]);return f}if(b.x>a.x&&b.y>=a.y)return f.push([b.x,a.y]),f;if(f.push([Math.max(a.x+e,d.x2+e),a.y]),d.y<=c.y2)f.push([f.last()[0],Math.min(c.y-e,d.y-e)]),f.push([b.x,f.last()[1]]);else{var h=this.mid(c.y2,d.y);f.push([f.last()[0],h],[b.x,h])}}if("b"==b.dir){if(d.x>a.x){if(b.y>a.y){var g=this.mid(d.x,a.x);f.push([g,a.y],[g,d.y2+e],[b.x,d.y2+e])}else f.push([b.x,a.y]);return f}if(b.x>a.x&&b.y<=a.y)return f.push([b.x,a.y]),f;if(f.push([Math.max(a.x+e,d.x2+e),a.y]),d.y2>=c.y)f.push([f.last()[0],Math.max(c.y2+e,d.y2+e)]),f.push([b.x,f.last()[1]]);else{var h=this.mid(c.y,d.y2);f.push([f.last()[0],h],[b.x,h])}}return f},this.getLinkerPoints=function(a,b){var c,d=a.linkend.data("ownerCt").view,e=d.set.getBBox();if("t"==a.dir)if(b.dir){var f=b.linkend.data("ownerCt").view,g=f.set.getBBox();c=this.getTopSTPoints(a,b,e,g)}else c=this.getTopSPoints(a,b,a.linkend.data("ownerCt").view.set.getBBox());else if("b"==a.dir)if(b.dir){var f=b.linkend.data("ownerCt").view,g=f.set.getBBox();c=this.getBottomSTPoints(a,b,e,g)}else c=this.getBottomSPoints(a,b,a.linkend.data("ownerCt").view.set.getBBox());else if("l"==a.dir)if(b.dir){var f=b.linkend.data("ownerCt").view,g=f.set.getBBox();c=this.getLeftSTPoints(a,b,e,g)}else c=this.getLeftSPoints(a,b,a.linkend.data("ownerCt").view.set.getBBox());else if("r"==a.dir)if(b.dir){var f=b.linkend.data("ownerCt").view,g=f.set.getBBox();c=this.getRightSTPoints(a,b,e,g)}else c=this.getRightSPoints(a,b,a.linkend.data("ownerCt").view.set.getBBox());return c.unshift([a.x,a.y]),c.push([b.x,b.y]),c};var b=null;this.paths=null,this.arrow=null,this.draw=function(){this.drawByPoints(this.getLinkerPoints(this.src,this.target))},this.drawByPoints=function(a){this.paths?this.paths.remove():null,this.paths=this.paper.set();for(var b=0;b<a.length-1;b++){var c=a[b],d=a[b+1],e=this.paper.path("M"+c[0]+","+c[1]+"L"+d[0]+","+d[1]);if(this.paths.push(e),e.mousedown(function(a){a.stopPropagation()}).attr({"stroke-width":2,cursor:"pointer","stroke-dasharray":this.dasharray}),b>=1&&b+1<=a.length-2){c[0]==d[0]?(e.dir="x",e.attr({cursor:"ew-resize"})):(e.dir="y",e.attr({cursor:"ns-resize"}));var f=this;e.idx=b,e.drag(function(a,b){var c=this.idx;if("x"==this.dir){var d=this.startValue+a,e=this.attr("path");e[0][1]=e[1][1]=d,this.attr("path",e);var g=f.paths[c-1],h=g.attr("path");h[1][1]=d,g.attr("path",h);var i=f.paths[c+1],j=i.attr("path");j[0][1]=d,i.attr("path",j)}else{var k=this.startValue+b,e=this.attr("path");e[0][2]=e[1][2]=k,this.attr("path",e);var g=f.paths[c-1],h=g.attr("path");h[1][2]=k,g.attr("path",h);var i=f.paths[c+1],j=i.attr("path");j[0][2]=k,i.attr("path",j)}f.drawArrow(),f.dehighlight(),f.highlight()},function(){"x"==this.dir?this.startValue=this.attr("path")[0][1]:this.startValue=this.attr("path")[0][2];var a=f.linkDelegate;a.view.ownerCt.selModel?a.view.ownerCt.selModel.selectLinker(f):null},function(){delete this.startValue})}}this.drawArrow()},this.drawArrow=function(){this.arrowDragging?delete this.arrowDragging:this.arrow?this.arrow.remove():null,this.arrow=null;var a=this.paths[this.paths.length-1].attr("path"),b=[],c={x:a[1][1],y:a[1][2]};b.push("M",c.x,c.y);var d={x:a[0][1],y:a[0][2]};c.x==d.x?c.y<d.y?b.push("L",c.x+4,c.y+12,"L",c.x-4,c.y+12,"Z"):b.push("L",c.x+4,c.y-12,"L",c.x-4,c.y-12,"Z"):c.x<d.x?b.push("L",c.x+12,c.y+4,"L",c.x+12,c.y-4,"Z"):b.push("L",c.x-12,c.y+4,"L",c.x-12,c.y-4,"Z"),this.arrow=this.paper.path(b.join(",")).attr("fill","black").attr("cursor","move"),this.arrow.mousedown(function(a){a.stopPropagation()});var e=this,f=this.linkDelegate;this.arrow.drag(function(a,b){if(e.target.linkend){var c=e.target.linkend.inlinkers.indexOf(e);c>-1&&e.target.linkend.inlinkers.splice(c,1)}e.detectAndDraw(this.dx+a,this.dy+b),e.dehighlight(),e.highlight(),e.paths.toFront(),e.arrow.toFront(),this.hide()},function(){this.dx=e.target.x-e.src.x,this.dy=e.target.y-e.src.y,f.view.ownerCt.selModel?f.view.ownerCt.selModel.selectLinker(e):null,e.arrowDragging=!0},function(){e.arrowDragging?delete e.arrowDragging:(this.remove(),e.saveToLinkends(),e.complete())})},this.complete=function(){b?b.remove():null,b=null;var a=this,c=this.linkDelegate;this.paths.click(function(b){b.stopPropagation(),c.view.ownerCt.fireEvent("canvasclicked"),c.view.ownerCt.selModel?c.view.ownerCt.selModel.selectLinker(a):null})},this.saveToLinkends=function(){this.target.linkend&&-1==this.target.linkend.inlinkers.indexOf(this)&&this.target.linkend.inlinkers.push(this),this.src.linkend&&-1==this.src.linkend.outlinkers.indexOf(this)&&this.src.linkend.outlinkers.push(this)},this.highlight=function(){this.dehighlight(),this.fx=[this.paths.glow({width:2})],this.paths.toFront(),this.arrow.toFront()},this.dehighlight=function(){this.fx?this.fx[0].remove():null,delete this.fx};var c=this.linkDelegate.view.ownerCt;this.detectAndDraw=function(a,d){b?b.remove():null,b=null;var e={x:Math.round(this.src.x+a),y:Math.round(this.src.y+d)},f={x:e.x-5,y:e.y-5,width:10,height:10},g=c.detectViewsByRect(f,1,function(a){return null!=a.linkDelegate})[0];if(g&&(g.linkDelegate.set.show(),Ext.each(g.linkDelegate.set,function(a){return GraphicDesigner.isBBoxIntersect(a.getBBox(),f)?(e.linkend=a,!1):void 0}),e.linkend)){var h=e.linkend;e.dir=h.data("spec"),e.x=h.attr("cx"),e.y=h.attr("cy"),b=h.paper.circle(e.x,e.y,10).attr({fill:"red",stroke:"red",opacity:.5}),h.toFront()}this.target=e,this.draw()},this.remove=function(){if(this.dehighlight(),this.paths.remove(),this.arrow.remove(),this.src.linkend){var a=this.src.linkend.outlinkers.indexOf(this);a>-1&&this.src.linkend.outlinkers.splice(a,1)}if(this.target.linkend){var a=this.target.linkend.inlinkers.indexOf(this);a>-1&&this.target.linkend.inlinkers.splice(a,1)}}}Ext.define("GraphicDesigner.BaseObject",{constructor:function(a){Ext.apply(this,a),this.init&&this.init()},init:function(){}}),Ext.define("GraphicDesigner.CanvasPanel",{extend:"Ext.panel.Panel",xtype:"gdcanvaspanel",gridHidden:!1,views:[],autoScroll:!0,paperWidth:800,paperHeight:1280,constraint:!1,constraintPadding:5,bgColor:"#ffffff",selModel:{xtype:"gdselmodel"},attributesInspectorPanel:{xtype:"gdattributesinspectorpanel"},clipboard:{xtype:"gdclipboard"},shortcutController:{xtype:"gdshortcutcontroller"},preProcessRestoreData:Ext.emptyFn,bodyCls:"gd-canvas-bg",html:'<div scope="container" style="display:inline-block;"></div>',viewonly:!1,setBgColor:function(a){this.bgColor=a,this.bgLayer.css({"background-color":a})},hideGrid:function(){this.gridHidden=!0,this.gridLayer.hide()},showGrid:function(){this.gridHidden=!1,this.gridLayer.show()},toggleGrid:function(){this.gridHidden?this.showGrid():this.hideGrid()},getSize:function(){return[$(this.paper.canvas).width(),$(this.paper.canvas).height()]},getCanvas:function(){return this.paper.canvas},getDataUrl:function(a){a&&(this.selModel?this.selModel.clearSelection():null);var b=(new XMLSerializer).serializeToString(this.getCanvas());return"data:image/svg+xml,"+encodeURIComponent(b)},getPngUrl:function(){var a=$(this.getCanvas()),b=$('<img src="'+this.getDataUrl(!0)+'" />');b.width(a.width()).height(a.height()),$(document.body).append(b),b.on("load",function(){$(this).hide()});var c=$("<canvas></canvas>");c.attr("width",a.width()).attr("height",a.height());var d=c[0].getContext("2d");d.fillStyle=this.bgColor,d.fillRect(0,0,a.width(),a.height()),d.drawImage(b[0],0,0,a.width(),a.height());var e=c[0].toDataURL();return b.remove(),c.remove(),e},downloadImage:function(a){var b=this.getPngUrl();b=b.replace(/^data:image\/[^;]*/,"data:application/octet-stream"),b=b.replace(/^data:application\/octet-stream/,"data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20");var c=$('<a href="#" download="'+a+'.png"></a>');c.attr("href",b),c[0].click(),c.remove()},fullscreen:function(a){a||(a=document.documentElement),document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():a.requestFullscreen?a.requestFullscreen():document.documentElement.msRequestFullscreen?a.msRequestFullscreen():document.documentElement.mozRequestFullScreen?a.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},setPaperSize:function(a,b){this.paperWidth=a,this.paperHeight=b,this.container.parent().parent().parent().stop(),this.viewonly?($(this.body.dom).addClass("gd-canvas-bg-readonly"),$(this.layout.innerCt.dom).addClass("gd-canvas-readonly"),this.container.width(a).height(b),this.canvasContainer.css({left:0,top:0}).width(a).height(b),this.bgLayer.css({left:0,top:0}).width(a).height(b),this.container.parent().parent().parent().animate({scrollTop:0,scrollLeft:0},300),this.readOnlyMask.show(),this.selModel?this.selModel.clearSelection():null,this.hideGrid()):($(this.body.dom).removeClass("gd-canvas-bg-readonly"),$(this.layout.innerCt.dom).removeClass("gd-canvas-readonly"),this.container.width(a+700).height(b+700),this.canvasContainer.css({left:300,top:300}).width(a+100).height(b+100),this.bgLayer.css({left:50,top:50}).width(a).height(b),this.container.parent().parent().parent().animate({scrollTop:250,scrollLeft:140},300),this.readOnlyMask.hide(),this.showGrid())},drawDocker:function(a,b){if(a&&a.spec&&!isNaN(a.value)){this.__dockLines||(this.__dockLines=[]);var c;"x"==a.spec?(c=$('<div class="gd-docker-v"></div>').height(this.container.height()).css("top",0),c.css("left",this.canvasContainer.position().left-this.container.position().left+this.bgLayer.position().left+a.value)):(c=$('<div class="gd-docker-h"></div>').width(this.container.width()).css("left",0),c.css("top",this.canvasContainer.position().top-this.container.position().top+this.bgLayer.position().top+a.value)),b&&c.css("background-color",b),this.container.append(c),this.__dockLines.push(c)}},clearDockers:function(){Ext.each(this.__dockLines,function(a){a.remove()}),delete this.__dockLines},asViewMode:function(a){this.attributesInspectorPanel&&this.attributesInspectorPanel[a?"hide":"show"](),this.viewonly!=a&&this.fireEvent("viewmodechange",a),this.viewonly=a,this.setPaperSize(this.paperWidth,this.paperHeight)},afterLayout:function(a){this.attributesInspectorPanel&&(this.attributesInspectorPanel.show(),this.attributesInspectorPanel.alignTo(this.body,"tr-tr?"),this.attributesInspectorPanel.layoutInspector(),this.attributesInspectorPanel[this.viewonly?"hide":"show"]()),this.callParent(arguments)},initComponent:function(){this.selModel&&(this.selModel=Ext.widget(this.selModel)),this.callParent()},afterRender:function(){this.attributesInspectorPanel?this.attributesInspectorPanel=Ext.widget(this.attributesInspectorPanel):null,this.attributesInspectorPanel?this.attributesInspectorPanel.owner=this:null,this.shortcutController?this.shortcutController=Ext.widget(this.shortcutController):null,this.shortcutController?this.shortcutController.owner=this:null,this.shortcutController?this.shortcutController.build():null,this.clipboard?this.clipboard=Ext.widget(this.clipboard):null,this.clipboard?this.clipboard.owner=this:null,this.clipboard?this.clipboard.build():null,window.cp=this,this.constraintPadding<0&&(this.constraintPadding=0);var a=this;this.callParent(),this.container=$(this.el.dom).find("div[scope=container]"),this.canvasContainer=$('<div class="gd-canvas-container"></div>'),this.container.append(this.canvasContainer),this.bgLayer=$('<div class="gd-bg-layer"></div>').css("background-color",this.bgColor),this.canvasContainer.append(this.bgLayer),this.gridLayer=$('<svg class="gd-grid-layer" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="smallGrid" width="8" height="8" patternUnits="userSpaceOnUse"><path d="M 8 0 L 0 0 0 8" fill="none" stroke="#9CDEF1" stroke-width="0.5"/></pattern><pattern id="grid" width="80" height="80" patternUnits="userSpaceOnUse"><rect width="80" height="80" fill="url(#smallGrid)"/><path d="M 80 0 L 0 0 0 80" fill="none" stroke="#9CDEF1" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" /></svg>'),this.bgLayer.append(this.gridLayer),this.canvasLayer=$('<div style="width:100%;height:100%;"></div>');var b=Raphael(this.canvasLayer[0],"100%","100%");this.bgLayer.append(this.canvasLayer),this.readOnlyMask=$('<div class="gd-readonly-mask"></div>').css({top:"0px",left:"0px"}),this.bgLayer.after(this.readOnlyMask),this.paper=b,this.gridHidden&&this.hideGrid(),this.setPaperSize(this.paperWidth,this.paperHeight),this.fireLastCanvasClick=function(){c=a.layout.innerCt.dom};var c,d=function(b){return a.layout&&a.layout.innerCt&&a.layout.innerCt.dom?(c=b.target,void(c=b.target==a.layout.innerCt.dom||0!=$(b.target).parents("#"+a.layout.innerCt.dom.id).length?a.layout.innerCt.dom:null)):void $(this).off("mousedown",d)};$(document).on("mousedown",d);var e=function(b){if(!a.layout||!a.layout.innerCt||!a.layout.innerCt.dom)return void $(this).off("keydown",e);if(c==a.layout.innerCt.dom){if(b.stopPropagation(),-1!=[8,37,38,39,40].indexOf(b.keyCode)){if(-1!=["INPUT","TEXTAREA"].indexOf(b.srcElement.tagName))return;b.preventDefault()}GraphicDesigner.viewEditing||a.fireEvent("keydown",b),a.selModel&&a.selModel.getSelections().filter(function(a){!a.editing&&a.fireEvent&&a.fireEvent("keydown",b)})}};$(document).on("keydown",e);var f=function(b){if(!a.layout||!a.layout.innerCt||!a.layout.innerCt.dom)return void $(this).off("keyup",f);if(c==a.layout.innerCt.dom){if(b.stopPropagation(),8==b.keyCode){if(-1!=["INPUT","TEXTAREA"].indexOf(b.srcElement.tagName))return;b.preventDefault(),a.selModel?a.selModel.removeLinkerSels():null}GraphicDesigner.viewEditing||a.fireEvent("keyup",b),a.selModel&&a.selModel.getSelections().filter(function(a){!a.editing&&a.fireEvent&&a.fireEvent("keyup",b)})}};$(document).keyup(f),window.paper=b,this.selModel?this.selModel.build(this):null;var g=[];Ext.each(this.views,function(a){g.push(Ext.widget(a))}),this.views=g,Ext.each(this.views,function(b){a.addSubView(b)})},getSubViews:function(){return this.views.slice()},getCanvasDescription:function(){return{canvas:{paperWidth:this.paperWidth,paperHeight:this.paperHeight,bgColor:GraphicDesigner.translateHexColorFromRgb(this.bgLayer.css("background-color"))},views:this.views.map(function(a){return a.getGraphicDescription()})}},restoreCanvasByDescription:function(a){a&&(this.removeAllViews(),Ext.isObject(a.canvas)&&(this.rendered?(this.bgLayer.css("background-color",a.canvas.bgColor),this.setPaperSize(a.canvas.paperWidth,a.canvas.paperHeight)):(this.bgColor=a.canvas.bgColor,this.paperWidth=a.canvas.paperWidth,this.paperHeight=a.canvas.paperHeight)),Ext.isArray(a.views)&&this.restoreViewsByDescriptions(a.views))},restoreViewsByDescriptions:function(a){function b(){d.filter(function(a){a.afterRestoreByDescription(c)})}if(Ext.isArray(a)){a.sort(function(a,b){return isNaN(null==a.zIndex)||isNaN(b.zIndex)?1:a.zIndex-b.zIndex});var c=this,d=[];return a.filter(function(a){if(a.hasOwnProperty("typeName")){c.preProcessRestoreData(a);var b=c.addSubView(Ext.create(a.typeName,a));b?d.push(b):null}}),this.rendered?b():this.on("afterRender",function(){b()}),d}},addSubView:function(a){return(a=Ext.widget(a))?(null==a.zIndex&&(a.zIndex=this.views.length),-1==this.views.indexOf(a)&&this.views.push(a),this.rendered&&(a.ownerCt=this,a.viewId||(a.viewId=Raphael.createUUID()),a.buildUI&&a.buildUI(this.paper),this.fireEvent("viewadd",a)),a):null},getView:function(a){var b=this.views.filter(function(b){return b.viewId==a});return b.length>0?b[0]:null},getViewAt:function(a){return this.views[a]},findViewsBy:function(a){return this.views.slice().filter(a)},detectViewsByRect:function(a,b,c){a.x2||(a.x2=a.x+a.width),a.y2||(a.y2=a.y+a.height);var d=[];return(!b||isNaN(b))&&(b=9999999),Ext.each(this.views,function(e){return d.length>=b?!1:void((!c||c(e))&&Raphael.isBBoxIntersect(a,e.set.getBBox())&&d.push(e))}),d},removeView:function(a){this.views=this.views.filter(function(b){return b!=a}).filter(function(a){a.destroy()})},removeAllViews:function(){this.views.filter(function(a){a.destroy()}),this.views=[]},orderViewsZIndex:function(){Ext.each(this.views,function(a,b){a.zIndex=b,a.set.toFront(),a.labelDelegate?a.labelDelegate.textElement.toFront():null,a.fireEvent("zindexed")})},destroy:function(){this.attributesInspectorPanel?this.attributesInspectorPanel.destroy():null,this.shortcutController?this.shortcutController.destroy():null,this.removeAllViews(),this.selModel?this.selModel.destroy():null,this.callParent(arguments)}}),Ext.define("GraphicDesigner.SelectionModel",{extend:"Ext.Component",xtype:"gdselmodel",requires:["GraphicDesigner.CanvasPanel"],linkerSels:[],selectLinker:function(a){a.highlight(),this.linkerSels.push(a),this.fireEvent("selectionchange")},clearLinkerSels:function(){0!=this.linkerSels.length&&(this.linkerSels=this.linkerSels.filter(function(a){return a.dehighlight(),!1}),this.fireEvent("selectionchange"))},removeLinkerSels:function(){this.linkerSels.filter(function(a){a.remove()}),this.clearLinkerSels()},destroy:function(){$(document).off("click",this.documentClickListener)},build:function(a){this.ownerCt=a;var b=this;this.documentClickListener=function(b){$(b.target).parents(".x-boundlist ").length||$(b.target).parents(".x-menu").length||(GraphicDesigner.suspendClickEvent||a.fireEvent("canvasclicked"),delete GraphicDesigner.suspendClickEvent)},$(document).click(this.documentClickListener),a.on("canvasclicked",function(){b.clearSelection()}),a.on("viewclicked",function(c){a.fireLastCanvasClick(),b.clearLinkerSels();var d=[],e=[c];b.getSelections().filter(function(a){c!=a&&d.push(a)}),d.filter(function(a){a.selected=!1,a.fireEvent("deselected")});var f=!1;e.filter(function(a){a.selected||(f=!0,a.selected=!0,a.fireEvent("selected",e))}),(d.length||f)&&b.fireEvent("selectionchange")}),this.bindRegionSelection(a)},bindRegionSelection:function(a){var b=this,c=null,d=null,e=null,f=null,g=0,h=0,i=function(b){var g=b.pageX,h=b.pageY;if(0==b.buttons)return void j.apply(this,[b]);var i=f,k=e={x:Math.min(g,c.x)-i.left,y:Math.min(h,c.y)-i.top,width:Math.abs(c.x-g),height:Math.abs(c.y-h)};d||(d=$('<div class="gd-selmodel-selector"></div>'),a.container.append(d)),d.width(k.width).height(k.height).css({left:k.x+"px",top:k.y+"px"})},j=function(f){if(c=null,delete GraphicDesigner.selecting,$(document.body).off("mouseup",j),$(document.body).off("mousemove",i),d?d.remove():null,d=null,e&&(GraphicDesigner.suspendClick(),0!=a.views.length)){var k=e;e=null,k.x=k.x+g,k.y=k.y+h,k.x2=k.x+k.width,k.y2=k.y+k.height,new Ext.util.DelayedTask(function(){b.selectByRect(k)}).delay(1)}},k=function(d){if(0==d.button&&!GraphicDesigner.viewEditing&&!a.viewonly&&-1==["PATH","TEXT","RECT","CIRCLE","IMAGE"].indexOf(d.target.tagName.toUpperCase())){b.clearSelection(),GraphicDesigner.selecting=!0,c={x:d.pageX,y:d.pageY},f=a.container.offset();var e=a.canvasContainer.position(),k=a.bgLayer.position(),l=a.container.position();g=l.left-k.left-e.left,h=l.top-k.top-e.top,$(document.body).mousemove(i),$(document.body).mouseup(j)}};$(a.container).mousedown(k)},selectByRect:function(a){var b=[];Ext.each(this.ownerCt.views,function(c){Raphael.isBBoxIntersect(a,c.set.getBBox())&&b.push(c)}),this.select(b)},select:function(a){this.ownerCt.fireLastCanvasClick(),this.multiselOutline&&(this.multiselOutline.remove(),delete this.multiselOutline);var b=[],c=[],d=[],e=[],f=!1;a.filter(function(g){g.selected||(f=!0,g.selected=!0,g.fireEvent("selected",a)),b.push(g.frame.x),c.push(g.frame.y),d.push(g.frame.x+g.frame.width),e.push(g.frame.y+g.frame.height)}),f?this.fireEvent("selectionchange"):null},clearSelection:function(){this.clearLinkerSels();var a=!1;this.ownerCt.views.filter(function(b){b.selected&&(a=!0,b.selected=!1,b.fireEvent("deselected"))}),a&&this.fireEvent("selectionchange")},getSelections:function(){var a=[];return this.ownerCt.views.filter(function(b){b.selected&&a.push(b)}),a.concat(this.linkerSels)}}),Ext.define("GraphicDesigner.Toolbar",{extend:"Ext.toolbar.Toolbar",xtype:"gdtoolbar",cls:"gd-toolbar",extraFontFamilies:[],getCanvasPanel:Ext.emptyFn,initComponent:function(){var a=this,b=function(b,c){var d=this.key,e=this.value;Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style[d]=e,a.labelDelegate.updateStyle())})},c=function(a){a.length>1||(this.suspendEvents(!1),this.toggle(a[0].labelDelegate.style[this.key]==this.value),this.resumeEvents())},d=[{fontFamily:"Arial",text:'<span style="font-family:Arial;">Arial</span>'},{fontFamily:"Helvetica",text:'<span style="font-family:Helvetica;">Helvetica</span>'},{iconCls:"x",fontFamily:"Courier New",text:'<span style="font-family:Courier New;">Courier New</span>'},{fontFamily:"Verdana",text:'<span style="font-family:Verdana;">Verdana</span>'},{iconCls:"x",fontFamily:"Georgia",text:'<span style="font-family:Georgia;">Georgia</span>'},{fontFamily:"Times New Roman",text:'<span style="font-family:Times New Roman;">Times New Roman</span>'},{fontFamily:"Impact",text:'<span style="font-family:Impact;">Impact</span>'},{fontFamily:"Comic Sans MS",text:'<span style="font-family:Comic Sans MS;">Comic Sans MS</span>'},{fontFamily:"Tahoma",text:'<span style="font-family:Tahoma;">Tahoma</span>'},{fontFamily:"Garamond",text:'<span style="font-family:Garamond;">Garamond</span>'},{fontFamily:"Lucida Console",text:'<span style="font-family:Lucida Console;">Lucida Console</span>'},"-",{fontFamily:"宋体",text:'<span style="font-family:宋体;">宋体</span>'},{fontFamily:"微软雅黑",text:'<span style="font-family:微软雅黑;">微软雅黑</span>'},{fontFamily:"黑体",text:'<span style="font-family:黑体;">黑体</span>'}];Ext.each(this.extraFontFamilies,function(a){d.push({fontFamily:a.fontFamily,text:'<span style="font-family:'+a.fontFamily+';">'+a.display+"</span>"})}),this.items=[{xtype:"gdselectcombo",width:100,updateSels:function(a){if(!(a.length>1)){var b=this.menu.query('*[fontFamily="'+a[0].labelDelegate.style.fontFamily+'"]')[0];this.setText(b.text),Ext.each(this.ownerCt.query('*[iconCls="gdicon-checkmark"]'),function(a){a.setIconCls("x")}),b.setIconCls("gdicon-checkmark")}},handleItem:function(b){var c=b.fontFamily;this.setText(b.text),Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.fontFamily=c,a.labelDelegate.updateStyle())})},text:'<span style="font-family:Arial;">Arial</span>',
items:d},"-",{xtype:"gdsymbolnumberfield",minValue:10,maxValue:100,value:13,width:73,symbol:"px",updateSels:function(a){a.length>1||(this.suspendEvents(!1),this.setValue(a[0].labelDelegate.style.fontSize),this.resumeEvents())},listeners:{change:function(b,c){Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.fontSize=c,a.labelDelegate.updateStyle())})}}},"-",{iconCls:"gdicon-format_bold gd-style-btn",toggleGroup:Ext.id(),updateSels:function(a){a.length>1||(this.suspendEvents(!1),this.toggle("bold"==a[0].labelDelegate.style.fontWeight),this.resumeEvents())},listeners:{toggle:function(b,c){Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.fontWeight=c?"bold":"normal",a.labelDelegate.updateStyle())})}}},{iconCls:"gdicon-format_italic gd-style-btn",toggleGroup:Ext.id(),updateSels:function(a){a.length>1||(this.suspendEvents(!1),this.toggle("italic"==a[0].labelDelegate.style.fontStyle),this.resumeEvents())},listeners:{toggle:function(b,c){Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.fontStyle=c?"italic":"normal",a.labelDelegate.updateStyle())})}}},{iconCls:"gdicon-format_underlined gd-style-btn",toggleGroup:Ext.id(),updateSels:function(a){a.length>1||(this.suspendEvents(!1),this.toggle("underline"==a[0].labelDelegate.style.textDecoration),this.resumeEvents())},listeners:{toggle:function(b,c){Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.textDecoration=c?"underline":"",a.labelDelegate.updateStyle())})}}},{xtype:"gdcolorpickerbutton",getText:function(){return'<span class="gdicon-format_color_text gd-style-btn"></span>'},updateSels:function(a){a.length>1||this.updateColor(a[0].labelDelegate.style.color.substring(1))},doSetColor:function(b){Ext.each(a.selections,function(a){a.labelDelegate&&(a.labelDelegate.style.color="#"+b,a.labelDelegate.updateStyle())})}},{iconCls:"gdicon-format_align_left gd-style-btn",toggleGroup:a.id+"-align",allowDepress:!1,key:"align",value:"left",handler:b,updateSels:c},{iconCls:"gdicon-format_align_center gd-style-btn",toggleGroup:a.id+"-align",allowDepress:!1,key:"align",value:"center",handler:b,updateSels:c},{iconCls:"gdicon-format_align_right gd-style-btn",toggleGroup:a.id+"-align",allowDepress:!1,key:"align",value:"right",handler:b,updateSels:c},{iconCls:"gdicon-vertical_align_top gd-style-btn",toggleGroup:a.id+"-valign",allowDepress:!1,key:"valign",value:"top",handler:b,updateSels:c},{iconCls:"gdicon-vertical_align_center gd-style-btn",toggleGroup:a.id+"-valign",allowDepress:!1,key:"valign",value:"middle",handler:b,updateSels:c},{iconCls:"gdicon-vertical_align_bottom gd-style-btn",toggleGroup:a.id+"-valign",allowDepress:!1,key:"valign",value:"bottom",handler:b,updateSels:c},"-",{xtype:"gdcolorpickerbutton",getText:function(){return'<span class="gdicon-format_color_fill gd-style-btn"></span>'},updateSels:function(a){a.length>1||this.updateColor(a[0].style.fill.substring(1))},doSetColor:function(b){Ext.each(a.selections,function(a){a.style.fill="#"+b,a.updateStyle()})}},{xtype:"gdcolorpickerbutton",getText:function(){return'<span class="gdicon-border_color gd-style-btn"></span>'},updateSels:function(a){a.length>1||this.updateColor(a[0].style.lineColor.substring(1))},doSetColor:function(b){Ext.each(a.selections,function(a){a.style.lineColor="#"+b,a.updateStyle()})}},{xtype:"gdselectcombo",text:'<div style="position:relative;width:20px;height:16px;"><div style="position:absolute;width:100%;top:0px;background-color:black;height:4px;"></div><div style="position:absolute;width:100%;top:8px;background-color:black;height:3px;"></div><div style="position:absolute;width:100%;top:14px;background-color:black;height:2px;"></div></div>',updateSels:function(a){a.length>1||(Ext.each(this.menu.query('*[iconCls="gdicon-checkmark"]'),function(a){a.setIconCls("x")}),this.menu.query("*[lineWidth="+a[0].style.lineWidth+"]")[0].setIconCls("gdicon-checkmark"))},handleItem:function(b){var c=b.lineWidth;Ext.each(a.selections,function(a){a.style.lineWidth=c,a.updateStyle()})},items:[{lineWidth:0,text:"0px"},{lineWidth:1,text:"1px"},{lineWidth:2,text:"2px"},{lineWidth:3,text:"3px"},{lineWidth:4,text:"4px"},{lineWidth:5,text:"5px"},{lineWidth:6,text:"6px"},{lineWidth:8,text:"8px"},{lineWidth:10,text:"10px"}]},{xtype:"gdselectcombo",text:'<div style="position:relative;width:20px;height:16px;"><div style="position:absolute;width:100%;top:2px;background-color:black;height:2px;"></div><div style="position:absolute;width:40%;top:8px;background-color:black;height:2px;"></div><div style="position:absolute;width:40%;top:8px;left:12px;background-color:black;height:2px;"></div><div style="position:absolute;width:20%;top:14px;background-color:black;height:2px;"></div><div style="position:absolute;width:20%;top:14px;left:8px;background-color:black;height:2px;"></div><div style="position:absolute;width:20%;top:14px;left:16px;background-color:black;height:2px;"></div></div>',updateSels:function(a){a.length>1||(Ext.each(this.menu.query('*[iconCls="gdicon-checkmark"]'),function(a){a.setIconCls("x")}),a[0].style.lineStyle?this.menu.query('*[lineStyle="'+a[0].style.lineStyle+'"]')[0].setIconCls("gdicon-checkmark"):this.menu.items.items[0].setIconCls("gdicon-checkmark"))},handleItem:function(b){var c=b.lineStyle;Ext.each(a.selections,function(a){a.style.lineStyle=c,a.updateStyle()})},items:[{lineStyle:"",text:'<div class="gd-style-linestyle gd-style-line-normal"></div>'},{lineStyle:"-",text:'<div class="gd-style-linestyle gd-style-line-dashed"></div>'},{lineStyle:".",text:'<div class="gd-style-linestyle gd-style-line-dotted"></div>'},{lineStyle:"-.",text:'<div class="gd-style-linestyle gd-style-line-dash-dotted"></div>'}]},"-",{iconCls:"gdicon-flip_to_front gd-style-btn",handler:function(){Ext.each(a.selections,function(a){a.flipToFront()})}},{iconCls:"gdicon-flip_to_back gd-style-btn",handler:function(){Ext.each(a.selections,function(a){a.flipToBack()})}}],this.callParent()},afterRender:function(){var a=this,b=this.getCanvasPanel();b&&(b.rendered?b.selModel.on("selectionchange",function(){a.selections=this.getSelections(),a.handleSelectionChange()}):b.on("afterRender",function(){this.selModel.on("selectionchange",function(){a.selections=this.getSelections(),a.handleSelectionChange()})}),$(this.el.dom).click(function(a){a.stopPropagation(),b.fireLastCanvasClick()})),this.items.each(function(a){a.setDisabled?a.setDisabled(!0):null}),this.callParent(),setTimeout(function(){a.doLayout()},100)},handleSelectionChange:function(){if(0==this.selections.length)this.items.each(function(a){a.setDisabled?a.setDisabled(!0):null});else{var a=this.selections;this.items.each(function(b){b.setDisabled?b.setDisabled(!1):null,b.updateSels?b.updateSels(a):null})}}}),Ext.define("GraphicDesigner.View",{extend:"Ext.Component",xtype:"gdabstractview",requires:["GraphicDesigner.CanvasPanel"],resizable:!0,draggable:!0,shapes:[],minW:20,minH:20,frame:null,text:"",resizeDelegate:{xtype:"gdresizedelegate"},dragDelegate:{xtype:"gddragdelegate"},linkDelegate:{xtype:"gdlinkdelegate"},rotateDelegate:{xtype:"gdrotatedelegate"},labelDelegate:{xtype:"gdlabeldelegate"},keyDelegate:{xtype:"gdkeydelegate"},dockDelegate:{xtype:"gddockdelegate"},frameTipDelegate:{xtype:"gdframetipdelegate"},contextmenuDelegate:{xtype:"gdcontextmenudelegate"},inspectorDelegate:{xtype:"gdinspectordelegate"},getCustomDescription:Ext.emptyFn,restoreCustomDescription:Ext.emptyFn,updateStyle:function(){this.set.attr({fill:this.style.fill,"fill-opacity":this.style.fillOpacity,opacity:this.style.opacity,"stroke-width":this.style.lineWidth,stroke:this.style.lineColor,"stroke-dasharray":this.style.lineStyle})},getFrame:function(){return this.frame?this.frame:this.getDefaultFrame()},getDefaultFrame:function(){return{x:50,y:50,width:50,height:50}},getPreview:function(a){return[{type:"text",stroke:"black","stroke-width":1,y:a.y+a.height/2,text:"RAW VIEW"}]},redraw:Ext.emptyFn,layoutInRect:function(a){a.x=Math.round(a.x),a.y=Math.round(a.y),a.width=Math.round(a.width),a.height=Math.round(a.height);var b=this.ownerCt;b.constraint&&(a.x<b.constraintPadding&&(a.x=b.constraintPadding),a.y<b.constraintPadding&&(a.y=b.constraintPadding),a.x>b.paperWidth-b.constraintPadding-a.width&&(a.x=b.paperWidth-b.constraintPadding-a.width),a.y>b.paperHeight-b.constraintPadding-a.height&&(a.y=b.paperHeight-b.constraintPadding-a.height)),a.width=Math.max(a.width,this.minW),a.height=Math.max(a.height,this.minH),this.frame=a,this.redraw(),this.fireEvent("layout",a)},buildUI:function(a){this.set=a.add(this.shapes),this.style=Ext.apply({opacity:1,fill:"#ffffff",fillOpacity:1,lineColor:"#000000",lineWidth:2,lineStyle:""},this.style),this.updateStyle(),this.afterViewBuilt(),this.afterRender()},pre:function(){var a=this.ownerCt;return a.views[a.views.indexOf(this)-1]},next:function(){var a=this.ownerCt;return a.views[a.views.indexOf(this)+1]},flipToFront:function(){var a=this.ownerCt,b=a.views.indexOf(this);-1!=b&&b!=a.views.length-1&&(a.views.gdmove(b,b+1),a.orderViewsZIndex())},flipToBack:function(){var a=this.ownerCt,b=a.views.indexOf(this);-1!=b&&0!=b&&(a.views.gdmove(b,b-1),a.orderViewsZIndex(),this.fireEvent("zindexed"))},flipToTop:function(){var a=this.ownerCt,b=a.views.indexOf(this);-1!=b&&b!=a.views.length-1&&(a.views.gdmove(b,a.views.length-1),a.orderViewsZIndex(),this.fireEvent("zindexed"))},flipToBottom:function(){var a=this.ownerCt,b=a.views.indexOf(this);-1!=b&&0!=b&&(a.views.gdmove(b,0),a.orderViewsZIndex(),this.fireEvent("zindexed"))},afterViewBuilt:Ext.emptyFn,getGraphicDescription:function(){return Ext.apply({typeName:Ext.getClassName(this),viewId:this.viewId,frame:Ext.clone(this.frame),minW:this.minW,minH:this.minH,text:this.labelDelegate?this.labelDelegate.text:"",linkers:this.linkDelegate?this.linkDelegate.getLinkersData():null,zIndex:this.zIndex,style:this.style,labelStyle:this.labelDelegate?this.labelDelegate.style:null},this.getCustomDescription())},afterRender:function(){this._innerDlgts=[];var a=this;this.layoutInRect(this.getFrame());var b=!1,c=!1;this.on("dragstart",function(d,e,f){f.stopPropagation(),b?(b=!1,c=!0,a.fireEvent("dblclick")):(b=!0,setTimeout(function(){c||a.fireEvent("click"),b=!1,c=!1},400))}),this.set.drag(function(b,c,d,e,f){a.frame=a.set.getBBox(),a.fireEvent("dragmoving",b,c,d,e,f)},function(b,c,d){return 2==d.button?(a.ownerCt.fireEvent("viewclicked",a),void a.fireEvent("contextmenu",b,c,d)):(a.fireEvent("dragstart",b,c,d),void a.ownerCt.fireEvent("viewclicked",a))},function(b){a.fireEvent("dragend",b)}),this.set.click(function(a){a.stopPropagation()}),this.set.hover(function(){a.fireEvent("hover")},function(){a.fireEvent("unhover")}),this.dragDelegate&&(this.dragDelegate.xtype||(this.dragDelegate.xtype="gddragdelegate"),this.dragDelegate=Ext.widget(this.dragDelegate),this.dragDelegate.wireView(this)),this.labelDelegate||(this.labelDelegate={xtype:"gdlabeldelegate",editable:!1}),this.labelDelegate.xtype||(this.labelDelegate.xtype="gdlabeldelegate"),this.labelDelegate=Ext.widget(this.labelDelegate),this.labelDelegate.wireView(this),this.rotateDelegate&&(this.rotateDelegate.xtype||(this.rotateDelegate.xtype="gdrotatedelegate"),this.rotateDelegate=Ext.widget(this.rotateDelegate),this.rotateDelegate.wireView(this)),this.resizeDelegate&&(this.resizeDelegate.xtype||(this.resizeDelegate.xtype="gdresizedelegate"),this.resizeDelegate=Ext.widget(this.resizeDelegate),this.resizeDelegate.wireView(this)),this.linkDelegate&&(this.linkDelegate.xtype||(this.linkDelegate.xtype="gdlinkdelegate"),this.linkDelegate=Ext.widget(this.linkDelegate),this.linkDelegate.wireView(this)),this.keyDelegate&&(this.keyDelegate.xtype||(this.keyDelegate.xtype="gdkeydelegate"),this.keyDelegate=Ext.widget(this.keyDelegate),this.keyDelegate.wireView(this)),this.dockDelegate&&(this.dockDelegate.xtype||(this.dockDelegate.xtype="gddockdelegate"),this.dockDelegate=Ext.widget(this.dockDelegate),this.dockDelegate.wireView(this)),this.frameTipDelegate&&(this.frameTipDelegate.xtype||(this.frameTipDelegate.xtype="gdframetipdelegate"),this.frameTipDelegate=Ext.widget(this.frameTipDelegate),this.frameTipDelegate.wireView(this)),this.contextmenuDelegate&&(this.contextmenuDelegate.xtype||(this.contextmenuDelegate.xtype="gdcontextmenudelegate"),this.contextmenuDelegate=Ext.widget(this.contextmenuDelegate),this.contextmenuDelegate.wireView(this)),this.inspectorDelegate&&(this.inspectorDelegate.xtype||(this.inspectorDelegate.xtype="gdinspectordelegate"),this.inspectorDelegate=Ext.widget(this.inspectorDelegate),this.inspectorDelegate.wireView(this));for(var d in this)if(d.endsWith("Delegate")){var e=this[d];if(null!=e&&!e.rendered)try{Ext.isObject(e)&&!e.xtype&&(e.xtype="gdviewdelegate");var f=Ext.widget(e);f.wireView(this),this[d]=f,this._innerDlgts.push(f)}catch(g){}}this.rendered=!0,this.fireEvent("afterRender")},afterRestoreByDescription:function(a){var b=this.linkers;delete this.linkers,!Ext.isEmpty(b)&&this.linkDelegate&&this.linkDelegate.restoreLinkers(b),this.restoreCustomDescription()},setDisabled:function(a){this.disabled=a,a?(this.labelDelegate?this.labelDelegate.disableListeners():null,this.rotateDelegate?this.rotateDelegate.disableListeners():null,this.dragDelegate?this.dragDelegate.disableListeners():null,this.resizeDelegate?this.resizeDelegate.disableListeners():null,this.linkDelegate?this.linkDelegate.disableListeners():null,this.keyDelegate?this.keyDelegate.disableListeners():null,this.dockDelegates?this.dockDelegates.disableListeners():null,this.frameTipDelegate?this.dockDelegates.disableListeners():null,this.contextmenuDelegate?this.contextmenuDelegate.disableListeners():null,this.inspectorDelegate?this.inspectorDelegate.disableListeners():null,this._innerDlgts.filter(function(a){a.disableListeners()})):(this.labelDelegate?this.labelDelegate.enableListeners():null,this.rotateDelegate?this.rotateDelegate.enableListeners():null,this.dragDelegate?this.dragDelegate.enableListeners():null,this.resizeDelegate?this.resizeDelegate.enableListeners():null,this.linkDelegate?this.linkDelegate.enableListeners():null,this.keyDelegate?this.keyDelegate.enableListeners():null,this.dockDelegates?this.dockDelegates.enableListeners():null,this.frameTipDelegate?this.dockDelegates.enableListeners():null,this.contextmenuDelegate?this.contextmenuDelegate.enableListeners():null,this.inspectorDelegate?this.inspectorDelegate.enableListeners():null,this._innerDlgts.filter(function(a){a.enableListeners()}))},destroy:function(){this.selected&&this.fireEvent("deselected"),this.labelDelegate?this.labelDelegate.destroy():null,this.rotateDelegate?this.rotateDelegate.destroy():null,this.dragDelegate?this.dragDelegate.destroy():null,this.resizeDelegate?this.resizeDelegate.destroy():null,this.linkDelegate?this.linkDelegate.destroy():null,this.keyDelegate?this.keyDelegate.destroy():null,this.dockDelegates?this.dockDelegates.destroy():null,this.contextmenuDelegate?this.contextmenuDelegate.destroy():null,this.inspectorDelegate?this.inspectorDelegate.destroy():null,Ext.each(this._innerDlgts,function(a){a.destroy()}),this.set.remove(),this.ownerCt?this.ownerCt.removeView(this):null,this.inspectorDelegate?this.inspectorDelegate.bbEvent("destroy",[]):null,this.destroyed=!0,this.selected&&(this.ownerCt.selModel?this.ownerCt.selModel.fireEvent("selectionchange"):null)}}),Ext.define("GraphicDesigner.ViewDelegate",{extend:"GraphicDesigner.BaseObject",xtype:"gdviewdelegate",getEventListeners:Ext.emptyFn,preBuild:Ext.emptyFn,buildDelegate:Ext.emptyFn,doDestroy:Ext.emptyFn,wireView:function(a){this.view=a,this.preBuild(),this.buildDelegate(),this._listeners=this.getEventListeners(),this.enableListeners(),this.rendered=!0},enableListeners:function(){if(this.disabled=!1,Ext.isObject(this._listeners))for(var a in this._listeners)this.view.on(a,this._listeners[a])},disableListeners:function(){if(this.disabled=!0,Ext.isObject(this._listeners))for(var a in this._listeners)this.view.un(a,this._listeners[a])},destroy:function(){this.disableListeners(),this.destroyed=!0,this.doDestroy()}}),Ext.define("GraphicDesigner.SymbolNumberField",{extend:"Ext.form.field.Number",xtype:"gdsymbolnumberfield",symbol:"%",afterRender:function(){$(this.inputEl.dom).parent().css({position:"relative"});var a=$("<span>"+this.symbol+"</span>");a.css({position:"absolute",color:"#50504F",top:"3px",right:"3px"}),$(this.inputEl.dom).after(a),this.callParent()}}),Ext.define("GraphicDesigner.ColorPickerButton",{extend:"Ext.Button",xtype:"gdcolorpickerbutton",getText:function(){return'<span class="gdicon-color_lens"></span>'},doSetColor:function(a){},initComponent:function(){var a=this;this.text='<div style="height:16px;position:relative;overflow:hidden;">'+this.getText()+'<br /><div class="gd-style-font-color-indicator"></div></div>',this.menu={plain:!0,closeAction:"hide",items:[{xtype:"colorpicker",listeners:{select:function(b,c){this.ownerCt.close(),a.updateColor(c),a.doSetColor(c)},afterRender:function(){var b=this;$(this.el.dom).find("a.x-color-picker-item").hover(function(){var a=GraphicDesigner.translateHexColorFromRgb($(this).find("span").css("background-color"));$(b.nextSibling().el.dom).find(".gd-style-color-input").val(a.substring(1))},function(){$(b.nextSibling().el.dom).find(".gd-style-color-input").val(a.currentColor)})}}},{xtype:"panel",bodyPadding:2,html:'&nbsp;#<input class="gd-style-color-input" value="'+(a.currentColor?a.currentColor:"000000")+'" />',listeners:{afterRender:function(){$(this.el.dom).find(".gd-style-color-input").keydown(function(a){a.stopPropagation(),-1==[8,37,38,39,40].indexOf(a.keyCode)&&(a.keyCode>="a".charCodeAt()&&a.keyCode<="f".charCodeAt()||a.keyCode>="A".charCodeAt()&&a.keyCode<="F".charCodeAt()||a.keyCode>="0".charCodeAt()&&a.keyCode<="9".charCodeAt()?6==$(this).val().length&&a.preventDefault():a.metaKey||a.ctrlKey||a.preventDefault())}).keyup(function(b){if(13==b.keyCode){var c=$(this).val();if(6!=c.length)return;for(var d=!0,e=0;e<c.length;e++){var f=c[e].toLowerCase();if(!(f>="a"&&"f">=f||f>="0"&&"9">=f)){d=!1;break}}d&&(a.updateColor(c),a.doSetColor(c))}})}}}]},this.callParent()},updateColor:function(a){$(this.el.dom).find(".gd-style-font-color-indicator").css({"background-color":"#"+a}),this.currentColor=a,this.menu.el&&$(this.menu.el.dom).find(".gd-style-color-input").val(a)}}),Ext.define("GraphicDesigner.SelectCombo",{extend:"Ext.Button",xtype:"gdselectcombo",items:[],checkIconCls:"gdicon-checkmark",handleItem:Ext.emptyFn,initComponent:function(){var a=this,b=function(){Ext.each(this.ownerCt.query('*[iconCls="gdicon-checkmark"]'),function(a){a.setIconCls("x")}),this.setIconCls(a.checkIconCls),a.handleItem(this)};Ext.each(this.items,function(a){a.iconCls||(a.iconCls="x"),a.handler||(a.handler=b)}),this.menu=this.items,delete this.items,this.callParent()}}),function($){for(var supportedCSS,supportedCSSOrigin,styles=document.getElementsByTagName("head")[0].style,toCheck="transformProperty WebkitTransform OTransform msTransform MozTransform".split(" "),a=0;a<toCheck.length;a++)void 0!==styles[toCheck[a]]&&(supportedCSS=toCheck[a]);supportedCSS&&(supportedCSSOrigin=supportedCSS.replace(/[tT]ransform/,"TransformOrigin"),"T"==supportedCSSOrigin[0]&&(supportedCSSOrigin[0]="t")),eval('IE = "v"==""'),jQuery.fn.extend({rotate:function(a){if(0!==this.length&&"undefined"!=typeof a){"number"==typeof a&&(a={angle:a});for(var b=[],c=0,d=this.length;d>c;c++){var e=this.get(c);if(e.Wilq32&&e.Wilq32.PhotoEffect)e.Wilq32.PhotoEffect._handleRotation(a);else{var f=$.extend(!0,{},a),g=new Wilq32.PhotoEffect(e,f)._rootObj;b.push($(g))}}return b}},getRotateAngle:function(){for(var a=[],b=0,c=this.length;c>b;b++){var d=this.get(b);d.Wilq32&&d.Wilq32.PhotoEffect&&(a[b]=d.Wilq32.PhotoEffect._angle)}return a},stopRotate:function(){for(var a=0,b=this.length;b>a;a++){var c=this.get(a);c.Wilq32&&c.Wilq32.PhotoEffect&&clearTimeout(c.Wilq32.PhotoEffect._timer)}}}),Wilq32=window.Wilq32||{},Wilq32.PhotoEffect=function(){return supportedCSS?function(a,b){a.Wilq32={PhotoEffect:this},this._img=this._rootObj=this._eventObj=a,this._handleRotation(b)}:function(a,b){if(this._img=a,this._onLoadDelegate=[b],this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Wilq32={PhotoEffect:this},a.parentNode.insertBefore(this._rootObj,a),a.complete)this._Loader();else{var c=this;jQuery(this._img).bind("load",function(){c._Loader()})}}}(),Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof a.angle&&(this._angle=a.angle),this._parameters.animateTo="number"==typeof a.animateTo?a.animateTo:this._angle,this._parameters.step=a.step||this._parameters.step||null,this._parameters.easing=a.easing||this._parameters.easing||this._defaultEasing,this._parameters.duration=a.duration||this._parameters.duration||1e3,this._parameters.callback=a.callback||this._parameters.callback||this._emptyFunction,this._parameters.center=a.center||this._parameters.center||["50%","50%"],"string"==typeof this._parameters.center[0]?this._rotationCenterX=parseInt(this._parameters.center[0],10)/100*this._imgWidth*this._aspectW:this._rotationCenterX=this._parameters.center[0],"string"==typeof this._parameters.center[1]?this._rotationCenterY=parseInt(this._parameters.center[1],10)/100*this._imgHeight*this._aspectH:this._rotationCenterY=this._parameters.center[1],a.bind&&a.bind!=this._parameters.bind&&this._BindEvents(a.bind)},_emptyFunction:function(){},_defaultEasing:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},_handleRotation:function(a,b){return supportedCSS||this._img.complete||b?(this._setupParameters(a),void(this._angle==this._parameters.animateTo?this._rotate(this._angle):this._animateStart())):void this._onLoadDelegate.push(a)},_BindEvents:function(a){if(a&&this._eventObj){if(this._parameters.bind){var b=this._parameters.bind;for(var c in b)b.hasOwnProperty(c)&&jQuery(this._eventObj).unbind(c,b[c])}this._parameters.bind=a;for(var c in a)a.hasOwnProperty(c)&&jQuery(this._eventObj).bind(c,a[c])}},_Loader:function(){return IE?function(){var a=this._img.width,b=this._img.height;this._imgWidth=a,this._imgHeight=b,this._img.parentNode.removeChild(this._img),this._vimage=this.createVMLNode("image"),this._vimage.src=this._img.src,this._vimage.style.height=b+"px",this._vimage.style.width=a+"px",this._vimage.style.position="absolute",this._vimage.style.top="0px",this._vimage.style.left="0px",this._aspectW=this._aspectH=1,this._container=this.createVMLNode("group"),this._container.style.width=a,this._container.style.height=b,this._container.style.position="absolute",this._container.style.top="0px",this._container.style.left="0px",this._container.setAttribute("coordsize",a-1+","+(b-1)),this._container.appendChild(this._vimage),this._rootObj.appendChild(this._container),this._rootObj.style.position="relative",this._rootObj.style.width=a+"px",this._rootObj.style.height=b+"px",this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._eventObj=this._rootObj;for(var c;c=this._onLoadDelegate.shift();)this._handleRotation(c,!0)}:function(){this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._imgWidth=this._img.naturalWidth,this._imgHeight=this._img.naturalHeight;var a=Math.sqrt(this._imgHeight*this._imgHeight+this._imgWidth*this._imgWidth);this._width=3*a,this._height=3*a,this._aspectW=this._img.offsetWidth/this._img.naturalWidth,this._aspectH=this._img.offsetHeight/this._img.naturalHeight,this._img.parentNode.removeChild(this._img),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this._width),this._canvas.style.position="relative",this._canvas.style.left=-this._img.height*this._aspectW+"px",this._canvas.style.top=-this._img.width*this._aspectH+"px",this._canvas.Wilq32=this._rootObj.Wilq32,this._rootObj.appendChild(this._canvas),this._rootObj.style.width=this._img.width*this._aspectW+"px",this._rootObj.style.height=this._img.height*this._aspectH+"px",this._eventObj=this._canvas,this._cnv=this._canvas.getContext("2d");for(var b;b=this._onLoadDelegate.shift();)this._handleRotation(b,!0)}}(),_animateStart:function(){this._timer&&clearTimeout(this._timer),this._animateStartTime=+new Date,this._animateStartAngle=this._angle,this._animate()},_animate:function(){var a=+new Date,b=a-this._animateStartTime>this._parameters.duration;if(b&&!this._parameters.animatedGif)clearTimeout(this._timer);else{if(this._canvas||this._vimage||this._img){var c=this._parameters.easing(0,a-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration);this._rotate(~~(10*c)/10)}this._parameters.step&&this._parameters.step(this._angle);var d=this;this._timer=setTimeout(function(){d._animate.call(d)},10)}this._parameters.callback&&b&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var a=Math.PI/180;return IE?function(a){this._angle=a,this._container.style.rotation=a%360+"deg",this._vimage.style.top=-(this._rotationCenterY-this._imgHeight/2)+"px",this._vimage.style.left=-(this._rotationCenterX-this._imgWidth/2)+"px",this._container.style.top=this._rotationCenterY-this._imgHeight/2+"px",this._container.style.left=this._rotationCenterX-this._imgWidth/2+"px"}:supportedCSS?function(a){this._angle=a,this._img.style[supportedCSS]="rotate("+a%360+"deg)",this._img.style[supportedCSSOrigin]=this._parameters.center.join(" ")}:function(b){this._angle=b,b=b%360*a,this._canvas.width=this._width,this._canvas.height=this._height,this._cnv.translate(this._imgWidth*this._aspectW,this._imgHeight*this._aspectH),this._cnv.translate(this._rotationCenterX,this._rotationCenterY),this._cnv.rotate(b),this._cnv.translate(-this._rotationCenterX,-this._rotationCenterY),this._cnv.scale(this._aspectW,this._aspectH),this._cnv.drawImage(this._img,0,0)}}()},IE&&(Wilq32.PhotoEffect.prototype.createVMLNode=function(){document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{return!document.namespaces.rvml&&document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),function(a){return document.createElement("<rvml:"+a+' class="rvml">')}}catch(a){return function(a){return document.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}}())}(jQuery),Ext.override(Ext.layout.container.Auto,{calculateOverflow:function(a){var b,c,d,e,f,g,h,i=this;f="auto"===i.getOverflowXStyle(a),g="auto"===i.getOverflowYStyle(a),(f||g)&&(d=Ext.getScrollbarSize(),("gd-view-template-list"==this.owner.bodyCls||"gd-scrollbar"==this.owner.bodyCls)&&(d.width=9,d.height=9),h=a.overflowContext.el.dom,e=0,h.scrollWidth>h.clientWidth&&(e|=1),h.scrollHeight>h.clientHeight&&(e|=2),b=g&&2&e?d.width:0,c=f&&1&e?d.height:0,(b!==i.lastOverflowAdjust.width||c!==i.lastOverflowAdjust.height)&&(i.done=!1,a.invalidate({state:{overflowAdjust:{width:b,height:c},overflowState:e,secondPass:!0}})))}}),Array.prototype.gdmove=function(a,b){this.splice(b,0,this.splice(a,1)[0])},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(b&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d});var GraphicDesigner=GraphicDesigner||{};GraphicDesigner.suspendClick=function(){GraphicDesigner.suspendClickEvent=!0,setTimeout(function(){delete GraphicDesigner.suspendClickEvent},30)},GraphicDesigner.isBBoxInBBox=function(a,b,c){return a.x2=a.x+a.width,a.y2=a.y+a.height,b.x2=b.x+b.width,b.y2=b.y+b.height,c?a.x>b.x&&a.x2<b.x2&&a.y>b.y&&a.y2<b.y2:a.x>=b.x&&a.x2<=b.x2&&a.y>=b.y&&a.y2<=b.y2},GraphicDesigner.isPointInBox=function(a,b,c,d){return c.x2=c.x+c.width,c.y2=c.y+c.height,d?a<c.x2&&a>c.x&&b<c.y2&&b>c.y:a<=c.x2&&a>=c.x&&b<=c.y2&&b>=c.y},GraphicDesigner.isBBoxIntersect=function(a,b,c){if(a.x2=a.x+a.width,a.y2=a.y+a.height,b.x2=b.x+b.width,b.y2=b.y+b.height,!c)return Raphael.isBBoxIntersect(a,b);if(a.x==b.x&&a.x2==b.x2)return a.y2<=b.y||a.y>=b.y2?!1:!0;if(a.y==b.y&&a.y2==b.y2)return a.x2<=b.x||a.x>=b.x2?!1:!0;var d=GraphicDesigner.isPointInBox;return d(a.x,a.y,b,c)||d(a.x2,a.y,b,c)||d(a.x,a.y2,b,c)||d(a.x2,a.y2,b,c)||d(b.x,b.y,a,c)||d(b.x2,b.y,a,c)||d(b.x,b.y2,a,c)||d(b.x2,b.y2,a,c)},GraphicDesigner.transformShapeIntoFrame=function(a,b,c){a.transform("");var d=a.getBBox(),e=d.width,f=d.height;if(c)return a.transform("T"+(b.x-d.x)+","+(b.y-d.y)+"S"+b.width/e+","+b.height/f+","+b.x+","+b.y);var g=Math.min(b.width/e,b.height/f);return a.transform("T"+(b.x-d.x)+","+(b.y-d.y)+"S"+g+","+g+","+b.x+","+b.y)},GraphicDesigner.getCenter=function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},GraphicDesigner.translateHexColorFromRgb=function(a){function b(a){return isNaN(a)?"00":c[(a-a%16)/16]+c[a%16]}var c=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},Ext.define("GraphicDesigner.AttributesInspectorPanel",{extend:"Ext.toolbar.Toolbar",xtype:"gdattributesinspectorpanel",cls:"gd-attr-inspector",shadow:!1,defaults:{width:30,height:30},infoPanelVisible:!0,inspectors:[{xtype:"gdcanvasinfoinspector"},{xtype:"gdframeinfoinspector"}],updateByView:function(a,b,c){this.__VIEW_INSPECTORS||(this.__VIEW_INSPECTORS=this.query("*[observeTarget=view]")),this.__VIEW_INSPECTORS.filter(function(d){d.update?d.update(a,b,c):null})},updateByCanvas:function(){},onShow:function(){this.query("button[pressed=true]").filter(function(a){a.infoPanel?a.fireEvent("toggle",a,!0):null}),this.callParent(arguments)},onHide:function(){this.query("button[pressed=true]").filter(function(a){a.infoPanel?a.infoPanel.hide():null}),this.callParent(arguments)},initComponent:function(){this.vertical=!0,this.floating=!0,this.fixed=!0;var a=Ext.id()+"-inspector-toggle-group";Ext.each(this.inspectors,function(b){b.toggleGroup=a,b.allowDepress=!0}),this.items=this.inspectors,this.callParent()},layoutInspector:function(){this.query("button[pressed=true]").filter(function(a){a.infoPanel?a.fireEvent("toggle",a,!0):null})},afterRender:function(){var a=this;$(this.el.dom).click(function(b){b.stopPropagation(),a.owner.fireLastCanvasClick()}).prepend('<div class="gd-attr-inspector-header"></div>'),this.callParent(),this.infoPanelVisible&&this.getComponent(0)&&this.getComponent(0).toggle(!0)}}),Ext.define("GraphicDesigner.Inspector",{xtype:"gdinspector",extend:"Ext.button.Button",iconCls:"gd-inspector-item-icon",title:"",panelSize:{width:250,height:300},panelConfig:{},observeTarget:"view",layoutInfoPanel:function(a){var b=this;new Ext.util.DelayedTask(function(){b.infoPanel.show(),b.infoPanel.alignTo(b.ownerCt.el,"tr-tl",[1,11]),b.infoPanel.hide(),a?a(b.infoPanel):null}).delay(30)},initComponent:function(){var a=this;this.infoPanel=Ext.widget({xtype:"toolbar",vertical:!0,shadow:!1,cls:"gd-attr-inspector-floating-panel",style:"padding:0px!important;",layout:"column",listeners:{afterRender:function(){$(this.el.dom).click(function(b){b.stopPropagation(),a.ownerCt.owner.fireLastCanvasClick()})}},items:[{xtype:"header",cls:"gd-inspector-panel-header",title:this.title,style:"margin-bottom:0px;",height:20,columnWidth:1,listeners:{afterRender:function(){Ext.fly(this.el.query(".x-header-text")[0]).addCls("gd-inspector-panel-header-text"),$(this.el.dom).append('<div class="gdicon-fast_forward gd-inspector-panel-header-btn"></div>').find(".gd-inspector-panel-header-btn").click(function(){
a.toggle(!1)})}}},Ext.apply({xtype:"panel",height:this.panelSize.height-20,columnWidth:1},this.panelConfig)],width:this.panelSize.width,height:this.panelSize.height,floating:!0}),this.infoPanel.hide(),this.infoPanel.getComponent(1).on("afterRender",function(){$(this.el.dom).css("margin-bottom","0px")}),this.on("toggle",function(a,b){this.layoutInfoPanel(function(a){a[b?"show":"hide"]()})}),this.callParent()},afterRender:function(){this.callParent();var a=this;a.layoutInfoPanel()},destroy:function(){this.infoPanel.destroy(),this.callParent()}}),Ext.define("GraphicDesigner.ShortcutController",{extend:"Ext.Component",xtype:"gdshortcutcontroller",shortcutMap:{},build:function(){var a={"ctrl+C":function(a){if(a.selModel&&a.clipboard){var b=[];a.selModel.getSelections().filter(function(a){b.push(a.getGraphicDescription())}),0!=b.length&&(a.clipboard.ccData=b,a.clipboard.command="copy",a.fireEvent("copy"))}},"ctrl+V":function(a){if(a.selModel&&a.clipboard&&a.clipboard.ccData)if("cut"==a.clipboard.command){var b=[];a.clipboard.ccData.filter(function(a){b.push(Ext.clone(a))});var c=a.restoreViewsByDescriptions(b);a.selModel.clearSelection(),a.selModel.select(c),a.fireEvent("cutpaste",c),a.clipboard.command="copy"}else{var b=[],d={};a.clipboard.ccData.filter(function(a){d[a.viewId]=a,a.origViewId=a.viewId,a.viewId=Raphael.createUUID()}),a.clipboard.ccData.filter(function(a){a.linkers&&(a.linkers=a.linkers.filter(function(a){if(a.target.x+=20,a.target.y+=20,a.points.filter(function(a){a[0]+=20,a[1]+=20}),a.target&&a.target.viewId){var b=d[a.target.viewId];return b?(a.target.viewId=b.viewId,!0):!1}return!0}))}),a.clipboard.ccData.filter(function(a){a.frame.x+=20,a.frame.y+=20;var c=Ext.clone(a);b.push(c)});var c=a.restoreViewsByDescriptions(b);a.selModel.clearSelection(),a.selModel.select(c),a.fireEvent("copypaste",c)}},"ctrl+X":function(a){if(a.selModel&&a.clipboard){var b=[];a.selModel.getSelections().filter(function(a){b.push(a.getGraphicDescription())}),a.selModel.getSelections().filter(function(a){a.destroy()}),0!=b.length&&(a.clipboard.ccData=b,a.clipboard.command="cut",a.fireEvent("cut"))}}};a=Ext.applyIf(a,this.shortcutMap),this.owner.on("keydown",function(b){var c=[];(b.ctrlKey||b.metaKey)&&c.push("ctrl"),b.altKey&&c.push("alt"),b.shiftKey&&c.push("shift"),c.push(String.fromCharCode(b.keyCode));var d=a[c.join("+")];d?d(this,b):null})},destroy:function(){this.callParent()}}),Ext.define("GraphicDesigner.ClipBoard",{extend:"Ext.Component",xtype:"gdclipboard",build:function(){},destroy:function(){this.callParent()}}),Ext.define("GraphicDesigner.ViewsetPanel",{extend:"Ext.panel.Panel",xtype:"gdviewsetpanel",layout:"column",columnWidth:1,width:"100%",bodyPadding:"5 0 5 5",autoHeight:!0,cls:"gd-panel-bg",anchor:"100%",bodyCls:"gd-viewset-bg",viewTpls:[],initComponent:function(){var a=this;this.items=[],this.viewTpls.filter(function(b){var c=b.type;if(c){var d=Ext.ClassManager.getNameByAlias("widget."+c);d||(d=c);var e=Ext.ClassManager.get(d);return e?void a.items.push(Ext.apply({viewTemplate:!0,xtype:"panel",width:40,height:40,header:!1,title:b.title,keyword:b.keyword?b.keyword:"",cls:"gd-view-prview-small",viewCls:e,viewConfig:b.viewConfig,viewBox:!1,padding:2,html:'<div scope="canvas" style="position:absolute;"></div>',listeners:{afterRender:function(){var a=$(this.body.dom).find("div[scope=canvas]");a.width(this.getWidth()).height(this.getHeight());var b=this.ownerCt.ownerCt.previewer;Raphael(a[0]).add(e.prototype.getPreview({x:4,y:4,width:this.getWidth()-8,height:this.getHeight()-8}));var c=this;$(this.body.dom).find("div[scope=canvas]").css("cursor","move").hover(function(){b.query("*[itemId=title]")[0].setValue(c.title),b.show();var a=b.paper;a.clear(),a.add(c.viewCls.prototype.getPreview({x:4,y:4,width:a.width-8,height:a.height-20})),b.alignTo(c.el,"tr",[10,0])},function(){b.hide()});var d=this.ownerCt.ownerCt.getCanvasPanel();d&&a.mousedown(function(b){if(0==b.button&&!d.viewonly){$(this).data("mouseDownEvent",b),$(this).data("oposition",$(this).offset());var e=a.clone().append('<div class="gd-tpl-dragging-tip"></div>');$(this).data("clone",e),e.hide(),$(document.body).append(e.removeAttr("id").css({"z-index":123456,position:"absolute",x:$(this).offset().left,y:$(this).offset().top}));var f={x:$(d.paper.canvas).offset().left,y:$(d.paper.canvas).offset().top,width:$(d.paper.canvas).width(),height:$(d.paper.canvas).height()},g=!1,h=function(b){if(a.data("mouseDownEvent")){var c=a.data("clone"),d=a.data("mouseDownEvent"),e=b.pageX-d.pageX,h=b.pageY-d.pageY,i=a.data("oposition");c.show().css({position:"absolute",top:i.top+h,left:i.left+e}),b.pageX>=f.x&&b.pageX<=f.x+f.width&&b.pageY>=f.y&&b.pageY<=f.y+f.height?(g=!0,c.find(".gd-tpl-dragging-tip").hasClass("gdicon-checkmark")||c.find(".gd-tpl-dragging-tip").removeClass().addClass("gd-tpl-dragging-tip gd-tpl-dragging-droppable gdicon-checkmark")):(g=!1,c.find(".gd-tpl-dragging-tip").hasClass("gdicon-cross")||c.find(".gd-tpl-dragging-tip").removeClass().addClass("gd-tpl-dragging-tip gd-tpl-dragging-undroppable gdicon-cross"))}};$(document).mousemove(h);var i=function(b){if(a.removeData("mouseDownEvent"),a.data("clone")?a.data("clone").fadeOut(100,function(){$(this).remove()}):null,a.removeData("clone"),delete GraphicDesigner.currentEvent,$(document).off("mouseup",i),$(document).off("mousemove",h),$(d.paper.canvas).off("mousemove",h),g){var e=b.pageX-f.x,j=b.pageY-f.y,k=null;c.viewConfig&&(k=c.viewConfig.frame,!k&&c.viewConfig.getDefaultFrame&&(k=c.viewConfig.getDefaultFrame())),k||(k=c.viewCls.prototype.frame),k||(k=c.viewCls.prototype.getDefaultFrame());var l=d.addSubView(Ext.create(c.viewCls.getName(),Ext.applyIf({frame:{x:e-k.width/2,y:j-k.height/2,width:k.width,height:k.height}},c.viewConfig)));d.fireLastCanvasClick(),new Ext.util.DelayedTask(function(){d.fireEvent("viewclicked",l),d.fireEvent("viewdropped",l)}).delay(10)}};$(document).mouseup(i)}})}}},b.previewConfig)):void alert("no class found 4 "+c)}}),this.callParent()},renderHeaderEx:function(a){var b=this;$(a.el.dom).addClass("gd-viewset-header").click(function(){b.collapsed?b.expand(null,!1):b.collapse(null,!1)}),this.collapsed?$(a.el.dom).find(".x-header-text").before('<div class="gd-viewset-header-indicator gdicon-chevron_right"></div>'):$(a.el.dom).find(".x-header-text").before('<div class="gd-viewset-header-indicator gdicon-expand_more"></div>'),this.on("collapse",function(){$(a.el.dom).find(".gd-viewset-header-indicator").removeClass("gdicon-expand_more").addClass("gdicon-chevron_right")}),this.on("expand",function(){$(a.el.dom).find(".gd-viewset-header-indicator").removeClass("gdicon-chevron_right").addClass("gdicon-expand_more")})},afterRender:function(){var a=this,b=this.getHeader();b&&(b.rendered?this.renderHeaderEx(b):b.on("afterRender",function(){a.renderHeaderEx(this)})),this.callParent()}}),Ext.define("GraphicDesigner.Viewtemplatelist",{extend:"Ext.panel.Panel",xtype:"gdviewtemplatelist",layout:"column",bodyCls:"gd-view-template-list",getCanvasPanel:Ext.emptyFn,autoScroll:!0,viewsets:[],filter:function(a){Ext.each(this.query("*[viewTemplate=true]"),function(b){b[-1!=b.keyword.indexOf(a)?"show":"hide"]()})},clearFilter:function(){Ext.each(this.query("*[viewTemplate=true]"),function(a){a.show()})},initComponent:function(){window.tpll=this,this.previewer=Ext.widget({xtype:"toolbar",vertical:!0,border:!0,floating:!0,fixed:!0,cls:"gd-view-previewer",shadow:!1,width:200,height:150,layout:"fit",items:[{xtype:"panel",cls:"gd-previewer-panel",style:"margin-bottom:0px;",bodyStyle:"background-color:transparent;",bodyPadding:5,html:'<div scope="canvas" style="width:188px;height:108px;"></div>',listeners:{afterRender:function(){var a=$(this.body.dom).find("div[scope=canvas]");this.ownerCt.paper=Raphael(a[0])}},bbar:{style:"padding:0px!important;",items:["->",{itemId:"title",xtype:"displayfield",value:""},"->"]}}]}),this.previewer.show(),this.previewer.hide(),this.items=this.viewsets,this.callParent()},afterRender:function(){this.callParent(arguments);var a=this;new Ext.util.DelayedTask(function(){a.doLayout()}).delay(20)}}),Ext.define("GraphicDesigner.ContextMenuDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdcontextmenudelegate"}),Ext.define("GraphicDesigner.DockDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gddockdelegate",supportBoundDock:!0,supportCenterDock:!0,buildDelegate:function(){this.xBoundDockers=[],this.yBoundDockers=[],this.xCenterDockers=[],this.yCenterDockers=[];var a=this;this.supportCenterDock&&(this.xCenterDockers.push({spec:"x",getValue:function(){return a.view.frame.x+a.view.frame.width/2},dock:function(b,c){c.x=a.view.frame.x+a.view.frame.width/2-c.width/2}}),this.yCenterDockers.push({spec:"y",getValue:function(){return a.view.frame.y+a.view.frame.height/2},dock:function(b,c){c.y=a.view.frame.y+a.view.frame.height/2-c.height/2}})),this.supportBoundDock&&(this.xBoundDockers.push({spec:"x",dir:"l",getValue:function(){return a.view.frame.x},dock:function(b,c){"l"==b.dir?c.x=a.view.frame.x:"r"==b.dir&&(c.x=a.view.frame.x-c.width)}},{spec:"x",dir:"r",getValue:function(){return a.view.frame.x+a.view.frame.width},dock:function(b,c){"l"==b.dir?c.x=a.view.frame.x+a.view.frame.width:"r"==b.dir&&(c.x=a.view.frame.x+a.view.frame.width-c.width)}}),this.yBoundDockers.push({spec:"y",dir:"t",getValue:function(){return a.view.frame.y},dock:function(b,c){"t"==b.dir?c.y=a.view.frame.y:"b"==b.dir&&(c.y=a.view.frame.y-c.height)}},{spec:"y",dir:"b",getValue:function(){return a.view.frame.y+a.view.frame.height},dock:function(b,c){"t"==b.dir?c.y=a.view.frame.y+a.view.frame.height:"b"==b.dir&&(c.y=a.view.frame.y+a.view.frame.height-c.height)}})),Ext.each(this.getOtherDockers(),function(b){b.dir?a["x"==b.spec?"xBoundDockers":"yBoundDockers"].push(b):a["x"==b.spec?"xCenterDockers":"yCenterDockers"].push(b)})},getDockersByType:function(a){return me.__dockMap?me.__dockMap[a]:null},getOtherDockers:Ext.emptyFn,getEventListeners:function(){var a=this,b=this.view.ownerCt;return{resize:function(c,d,e,f,g,h){b.clearDockers();var i=!1,j=this;c.x2=c.x+c.width,c.y2=c.y+c.height,Math.abs(c.x+c.x+c.width-b.paperWidth)<=4?(b.drawDocker({spec:"x",value:b.paperWidth/2},"black"),-1!=["tl","l","bl"].indexOf(d)&&(c.width=c.x2+c.x2-b.paperWidth,c.x=c.x2-c.width),-1!=["tr","r","br"].indexOf(d)&&(c.width=b.paperWidth-c.x-c.x),i=!0):Ext.each(b.detectViewsByRect({x:c.x-6,y:-9999999,width:c.width+12,height:20999998},null,function(a){return a!=j&&null!=a.dockDelegate}),function(a){var e=!1,f=c.x+c.width/2;return Ext.each(a.dockDelegate.xCenterDockers,function(a){var g=a.getValue();return Math.abs(g-f)<=2?(e=!0,b.drawDocker({spec:a.spec,value:g}),-1!=["tl","l","bl"].indexOf(d)&&(c.width=c.x2+c.x2-g-g,c.x=c.x2-c.width),-1!=["tr","r","br"].indexOf(d)&&(c.width=g+g-c.x-c.x),!1):void 0}),e?(i=!0,!1):(Ext.each(a.dockDelegate.xBoundDockers,function(a){if(-1!=["l","r"].indexOf(a.dir)){var f=0;-1!=["tl","l","bl"].indexOf(d)&&(f=c.x),-1!=["tr","r","br"].indexOf(d)&&(f=c.x2);var g=a.getValue();return Math.abs(g-f)<=2?(e=!0,b.drawDocker({spec:a.spec,value:g}),-1!=["tl","l","bl"].indexOf(d)&&(c.x=g),-1!=["tr","r","br"].indexOf(d)&&(c.x2=g),c.width=c.x2-c.x,!1):void 0}}),e?(i=!0,!1):void 0)}),Math.abs(c.y+c.y+c.height-b.paperHeight)<=4?(b.drawDocker({spec:"y",value:b.paperHeight/2},"black"),-1!=["tl","t","tr"].indexOf(d)&&(c.height=c.y2+c.y2-b.paperHeight,c.y=c.y2-c.height),-1!=["bl","b","br"].indexOf(d)&&(c.height=b.paperHeight-c.y-c.y),i=!0):Ext.each(b.detectViewsByRect({x:-9999999,y:c.y-6,width:20999998,height:c.height+12},null,function(a){return a!=j&&null!=a.dockDelegate}),function(a){var e=!1,f=c.y+c.height/2;return Ext.each(a.dockDelegate.yCenterDockers,function(a){var g=a.getValue();return Math.abs(g-f)<=2?(e=!0,b.drawDocker({spec:a.spec,value:g}),-1!=["tl","t","tr"].indexOf(d)&&(c.height=c.y2+c.y2-g-g,c.y=c.y2-c.height),-1!=["bl","b","br"].indexOf(d)&&(c.height=g+g-c.y-c.y),!1):void 0}),e?(i=!0,!1):(Ext.each(a.dockDelegate.yBoundDockers,function(a){if(-1!=["t","b"].indexOf(a.dir)){var f=0;-1!=["tl","t","tr"].indexOf(d)&&(f=c.y),-1!=["bl","b","br"].indexOf(d)&&(f=c.y2);var g=a.getValue();return Math.abs(g-f)<=2?(e=!0,b.drawDocker({spec:a.spec,value:g}),-1!=["tl","t","tr"].indexOf(d)&&(c.y=g),-1!=["bl","b","br"].indexOf(d)&&(c.y2=g),c.height=c.y2-c.y,!1):void 0}}),e?(i=!0,!1):void 0)}),i&&(a.view.layoutInRect(c),a.view.fireEvent("resizedocked",d))},dragmoving:function(){b.clearDockers();var c=a.view.frame,d=!1,e=this;Math.abs(c.x+c.x+c.width-b.paperWidth)<=4?(b.drawDocker({spec:"x",value:b.paperWidth/2},"black"),c.x=(b.paperWidth-c.width)/2,d=!0):Ext.each(b.detectViewsByRect({x:c.x-2,y:-9999999,width:c.width+4,height:20999998},null,function(a){return a!=e&&null!=a.dockDelegate}),function(e){var f=!1;return Ext.each(e.dockDelegate.xCenterDockers,function(d){var e=d.getValue();return Ext.each(a.xCenterDockers,function(a){var g=a.getValue();return Math.abs(g-e)<=2?(f=!0,b.drawDocker({spec:d.spec,value:e}),a.docked?a.docked(d,c):d.dock(a,c),!1):void 0}),f?!1:void 0}),f||Ext.each(e.dockDelegate.xBoundDockers,function(d){var e=d.getValue();return Ext.each(a.xBoundDockers,function(a){var g=a.getValue();return Math.abs(g-e)<=2?(f=!0,b.drawDocker({spec:d.spec,value:e}),a.docked?a.docked(d,c):d.dock(a,c),!1):void 0}),f?!1:void 0}),f?(d=!0,!1):void 0}),Math.abs(c.y+c.y+c.height-b.paperHeight)<=4?(b.drawDocker({spec:"y",value:b.paperHeight/2},"black"),c.y=(b.paperHeight-c.height)/2,d=!0):Ext.each(b.detectViewsByRect({x:-9999999,y:c.y-2,width:20999998,height:c.height+4},null,function(a){return a!=e&&null!=a.dockDelegate}),function(e){var f=!1;return Ext.each(e.dockDelegate.yCenterDockers,function(d){var e=d.getValue();return Ext.each(a.yCenterDockers,function(a){var g=a.getValue();return Math.abs(g-e)<=2?(f=!0,b.drawDocker({spec:d.spec,value:e}),a.docked?a.docked(d,c):d.dock(a,c),!1):void 0}),f?!1:void 0}),f||Ext.each(e.dockDelegate.yBoundDockers,function(d){var e=d.getValue();return Ext.each(a.yBoundDockers,function(a){var g=a.getValue();return Math.abs(g-e)<=2?(f=!0,b.drawDocker({spec:d.spec,value:e}),a.docked?a.docked(d,c):d.dock(a,c),!1):void 0}),f?!1:void 0}),f?(d=!0,!1):void 0}),d&&(a.view.layoutInRect(c),a.view.fireEvent("dragdocked"))},resizeend:function(){b.clearDockers()},dragend:function(){b.clearDockers()}}}}),Ext.define("GraphicDesigner.DragDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gddragdelegate",buildDelegate:function(){this.view.set.attr("cursor","move")},getEventListeners:function(){var a;return{dragstart:function(b,c,d){2!=d.button&&(a=this.frame)},dragmoving:function(b,c,d,e,f){a&&this.layoutInRect({x:a.x+b,y:a.y+c,width:a.width,height:a.height})},dragend:function(b){a=null,GraphicDesigner.suspendClick()}}}}),Ext.define("GraphicDesigner.FrameTipDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdframetipdelegate",buildDelegate:function(){this.tooltip=$('<div class="gd-delegate-tooltip"><div scope="xy"><span scope="x">X:&nbsp;<span scope="value"></span></span>&nbsp;&nbsp;<span scope="y">Y:&nbsp;<span scope="value"></span></span></div><div scope="wh"><span scope="w">W:&nbsp;<span scope="value"></span></span>&nbsp;&nbsp;<span scope="h">H:&nbsp;<span scope="value"></span></span></div></div>').hide(),$(this.view.set.paper.canvas).after(this.tooltip)},layoutTooltip:function(a,b){var c=this.view.frame;a?(this.tooltip.find("div[scope=xy]").show(),this.tooltip.find("span[scope=x]").find("span[scope=value]").text(c.x),this.tooltip.find("span[scope=y]").find("span[scope=value]").text(c.y)):this.tooltip.find("div[scope=xy]").hide(),b?(this.tooltip.find("div[scope=wh]").show(),this.tooltip.find("span[scope=w]").find("span[scope=value]").text(c.width),this.tooltip.find("span[scope=h]").find("span[scope=value]").text(c.height)):this.tooltip.find("div[scope=wh]").hide();var d=$(this.view.ownerCt.paper.canvas).position();this.tooltip.css({left:c.x+d.left,top:c.y+d.top+c.height+10})},getEventListeners:function(){var a=this;return{keymovestart:function(){a.layoutTooltip(!0,!1),a.tooltip.show()},keymoveend:function(){a.tooltip.fadeOut(100)},resize:function(b,c){-1!=["tl","l","t","bl"].indexOf(c)?a.layoutTooltip(!0,!0):a.layoutTooltip(!1,!0),a.tooltip.stop().show()},resizedocked:function(b){-1!=["tl","l","t","bl"].indexOf(b)?a.layoutTooltip(!0,!0):a.layoutTooltip(!1,!0),a.tooltip.show()},resizeend:function(){a.tooltip.fadeOut(100)},dragdocked:function(){a.layoutTooltip(!0,!1)},dragmoving:function(b,c,d,e,f){a.layoutTooltip(!0,!1),a.tooltip.show()},dragend:function(b){a.tooltip.fadeOut(100)}}},doDestroy:function(){this.tooltip.remove()}}),Ext.define("GraphicDesigner.InspectorDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdinspectordelegate",bbEvent:function(a,b){this.view.ownerCt.attributesInspectorPanel?this.view.ownerCt.attributesInspectorPanel.updateByView(this.view,a,b):null},getEventListeners:function(){var a=this,b={dragend:function(){a.bbEvent("dragend",arguments)},keymoveend:function(){a.bbEvent("keymoveend",arguments)},resizeend:function(){a.bbEvent("resizeend",arguments)},selected:function(){a.bbEvent("selected",arguments)},deselected:function(){a.bbEvent("deselected",arguments)}};return Ext.each(this.otherBBEvents,function(c){b[c]=function(){a.bbEvent(c,arguments)}}),b},otherBBEvents:[]}),Ext.define("GraphicDesigner.KeyDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdkeydelegate",allowMove:!0,allowDelete:!0,getEventListeners:function(){var a=this;return this.endTask=new Ext.util.DelayedTask(function(){a.view.fireEvent("keymoveend")}),{keydown:function(b){if(this.editing)return b.preventDefault(),void b.stopPropagation();if(a.allowDelete&&(8==event.keyCode||46==event.keyCode))return void this.destroy();if(a.allowMove){switch(event.keyCode){case 37:var c=this.frame;c.x-=event.shiftKey?10:1,this.layoutInRect(c);break;case 38:var c=this.frame;c.y-=event.shiftKey?10:1,this.layoutInRect(c);break;case 39:var c=this.frame;c.x+=event.shiftKey?10:1,this.layoutInRect(c);break;case 40:var c=this.frame;c.y+=event.shiftKey?10:1,this.layoutInRect(c)}event.keyCode>=37&&event.keyCode<=40&&(a.endTask.cancel(),this.fireEvent("keymovestart"),a.endTask.delay(400))}}}}}),Ext.define("GraphicDesigner.LabelDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdlabeldelegate",editable:!0,textElement:null,text:"",updateStyle:function(){this.textElement.attr({"font-size":this.style.fontSize,"font-weight":this.style.fontWeight,"font-family":this.style.fontFamily,"font-style":this.style.fontStyle,fill:this.style.color}),$(this.textElement.node).attr("text-decoration",this.style.textDecoration),this.textHolder.css({"font-size":this.style.fontSize,"font-weight":this.style.fontWeight,"font-family":this.style.fontFamily,"font-style":this.style.fontStyle,color:this.style.color,"text-decoration":this.style.textDecoration,"text-align":this.style.align,"vertical-align":this.style.valign}),this.layoutElements()},layoutElements:function(){var a=this.getTextRect();this.textElement.attr("transform","");var b=null;switch(this.style.align){case"left":this.textElement.attr("text-anchor","start"),b=a.x+1;break;case"right":this.textElement.attr("text-anchor","end"),b=a.x+a.width-1;break;default:this.textElement.attr("text-anchor","middle"),b=a.x+a.width/2}var c=null;switch(this.style.valign){case"top":c=a.y+this.textElement.getBBox().height/2+1;break;case"bottom":c=a.y+a.height-this.textElement.getBBox().height/2-1;break;default:c=a.y+a.height/2}this.textElement.attr({x:b,y:c,transform:this.getTransformStr()})},getTransform:Ext.emptyFn,getTextRect:function(){return{x:10,y:10,width:20,height:20}},buildTextHolder:function(){this.textHolder=$('<input type="text" />').hide()},buildDelegate:function(){var a=this;this.view.labelStyle&&(this.style=this.view.labelStyle,delete this.view.labelStyle),this.textElement=this.view.set.paper.text(0,0,"_").drag(function(b,c,d,e,f){a.view.fireEvent("dragmoving",b,c,d,e,f)},function(b,c,d){return 2==d.button?void a.view.fireEvent("contextmenu",b,c,d):(d.stopPropagation(),void a.view.fireEvent("dragstart",b,c,d))},function(b){a.view.fireEvent("dragend",b)}).hover(function(){a.view.fireEvent("hover")},function(){a.view.fireEvent("unhover")}).click(function(a){a.stopPropagation()}),this.setText(this.text),this.buildTextHolder(),$(this.view.set.paper.canvas).after(this.textHolder),this.textHolder.css({position:"absolute","background-color":"transparent",border:"2px solid #F7DDAA","border-radius":2}).blur(function(){a.endEdit()}).keydown(function(b){return b.stopPropagation(),27==b.keyCode?void a.cancelEdit():((13==b.keyCode||9==b.keyCode)&&a.endEdit(),void(9==b.keyCode&&a.tabNext()))}).mouseup(function(a){GraphicDesigner.suspendClick()}),this.style=Ext.apply({fontSize:"13px",fontFamily:"Arial",fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",color:"#000000",align:"center",valign:"middle"},this.style),this.updateStyle()},tabNext:function(){var a=this.view.ownerCt.views;if(!(a.length<=1))for(var b=a.indexOf(this.view);;){b++;var c=a[b%a.length];if(null==c||c==this.view)return;if(c.labelDelegate&&c.labelDelegate.editable)return c.ownerCt.fireEvent("viewclicked",c),void new Ext.util.DelayedTask(function(){c.labelDelegate.startEdit()}).delay(50)}},getEventListeners:function(){var a=this;return{click:function(){a.endEdit()},deselected:function(){a.endEdit()},keydown:function(b){return this.editing?(b.preventDefault(),void b.stopPropagation()):void(a.editable&&32==b.keyCode&&(b.preventDefault(),a.startEdit()))},dblclick:function(){a.startEdit()},layout:function(){a.textHolder.is(":visible")&&(a.textHolder.hide(),a.textElement.show()),a.layoutElements()}}},doDestroy:function(){this.textElement.remove(),this.textHolder.remove()},getTransformStr:function(){var a=this.getTransform();return a?"r"+a.angle+","+a.cx+","+a.cy:null},cancelEdit:function(){this.textHolder.val(this.text).blur()},startEdit:function(){if(this.editable){this.textElement.hide();var a=this.getTextRect(),b=$(this.view.ownerCt.paper.canvas).position();this.textHolder.css({left:b.left+a.x,top:b.top+a.y,width:a.width,height:a.height});var c=this.getTransform();if(c){var d=this.view.set.paper.rect(a.x,a.y,a.width,a.height).hide(),e=d.transform(this.getTransformStr()).getBBox();this.textHolder.css({left:b.left+e.cx-a.width/2,top:b.top+e.cy-a.height/2}).rotate({angle:c.angle,center:[e.cx,e.cy]}),d.remove()}this.textHolder.show().val(this.text).select(),GraphicDesigner.viewEditing=!0,this.view.editing=!0}},endEdit:function(){if(this.view.editing){this.setText(this.textHolder.hide().val());var a=this;setTimeout(function(){delete GraphicDesigner.viewEditing,a.view.editing=!1},200)}},setText:function(a){this.text=a,this.view.dragDelegate&&this.textElement.attr("cursor","move"),this.textElement.attr("text",a).attr("title",a),this.text?this.textElement.show():this.textElement.attr("text","_").hide()}}),Ext.define("GraphicDesigner.LinkDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdlinkdelegate",linkends:["t","b","l","r"],redrawInOutLinkersWhenLayout:function(){this.set.forEach(function(a){var b=a.attr("cx"),c=a.attr("cy");Ext.each(a.outlinkers,function(a){a.src.x=b,a.src.y=c,a.draw(),a.complete()}),Ext.each(a.inlinkers,function(a){a.target.x=b,a.target.y=c,a.draw(),a.complete()}),a.toFront()})},getLinkersData:function(){var a=[];return this.set.forEach(function(b){b.outlinkers.filter(function(c){var d={x:c.target.x,y:c.target.y,dir:c.target.dir};d.viewId=c.target.linkend?c.target.linkend.data("ownerCt").view.viewId:null;var e=[];c.paths.forEach(function(a){var b=a.attr("path");e.push([b[1][1],b[1][2]])}),e.pop(),a.push({spec:b.data("spec"),target:d,points:e})})}),a},restoreLinkers:function(a){var b=this.view.ownerCt,c=this;a.filter(function(a){var d=c.getLinkendBySpec(a.spec);if(d){var e,f=a.target;if(f.dir&&f.viewId){var g=b.getView(f.viewId);g&&g.linkDelegate&&(e=g.linkDelegate.getLinkendBySpec(f.dir))}var h=new GDLinker({x:d.attr("cx"),y:d.attr("cy"),linkend:d,dir:a.spec});if(h.target={x:f.x,y:f.y,dir:f.dir,linkend:e},a.points){var i=Ext.apply([],a.points);i.unshift([h.src.x,h.src.y]),i.push([h.target.x,h.target.y]),h.drawByPoints(i)}else h.draw();h.saveToLinkends(),h.complete()}})},getLinkendBySpec:function(a){var b=null;return this.set.forEach(function(c){return c.data("spec")==a?(b=c,!1):void 0}),b},buildDelegate:function(){function a(a){a.mousedown(function(a){a.stopPropagation()}),a.drag(function(a,b){this.linker.detectAndDraw(a,b),this.toFront()},function(){this.linker=new GDLinker({x:Math.round(this.attr("cx")),y:Math.round(this.attr("cy")),dir:this.data("spec"),linkend:a})},function(){this.linker.saveToLinkends(),this.linker.complete(),delete this.linker})}var b=this.view.set.paper;if(this.set=b.set(),-1!=this.linkends.indexOf("t")){var c=this.produceLinkend("t");this.set.push(c),a(c)}if(-1!=this.linkends.indexOf("r")){var d=this.produceLinkend("r");this.set.push(d),a(d)}if(-1!=this.linkends.indexOf("b")){var e=this.produceLinkend("b");this.set.push(e),a(e)}if(-1!=this.linkends.indexOf("l")){var f=this.produceLinkend("l");this.set.push(f),a(f)}this.layoutElements();var g=this;this.set.hover(function(){g.set.show()},Ext.emptyFn),this.set.hide()},getEventListeners:function(){var a=this;return{hover:function(){GraphicDesigner.selecting||a.set.toFront().show()},unhover:function(){this.selected||a.set.hide()},zindexed:function(){a.view.selected&&new Ext.util.DelayedTask(function(){a.set.toFront()}).delay(100)},resizestart:function(){this.ownerCt.selModel?this.ownerCt.selModel.clearLinkerSels():null},selected:function(b){a.set.toFront().show()},deselected:function(){a.set.hide()},layout:function(){a.layoutElements(),a.redrawInOutLinkersWhenLayout()},dragstart:function(){a.set.toFront().show()}}},doDestroy:function(){this.set.forEach(function(a){a.outlinkers.filter(function(a){a?a.remove():null})}),this.set.remove()},layoutElements:function(){var a=this.view.frame;this.set.forEach(function(b){if("linkend"==b.data("type")){var c=a.width/2,d=a.height/2;switch(b.data("spec")){case"t":b.attr({cx:a.x+c,cy:a.y});break;case"r":b.attr({cx:a.x+a.width,cy:a.y+d});break;case"b":b.attr({cx:a.x+c,cy:a.y+a.height});break;case"l":b.attr({cx:a.x,cy:a.y+d})}}})},produceLinkend:function(a){var b=this.view.set.paper,c=b.circle(0,0,3).data("type","linkend").data("spec",a).data("ownerCt",this).attr({fill:"white",cursor:"crosshair",stroke:"#883333"}).click(function(a){a.stopPropagation()});return c.outlinkers=[],c.inlinkers=[],c}}),Ext.define("GraphicDesigner.MultilineLabelDelegate",{extend:"GraphicDesigner.LabelDelegate",xtype:"gdmultilinelabeldelegate",buildTextHolder:function(){this.textHolder=$('<textarea style="resize:none;outline:none;" />').hide()}}),Ext.define("GraphicDesigner.ResizeDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdresizedelegate",resizers:["tl","t","tr","r","br","b","bl","l"],showOutline:!0,outline:null,buildDelegate:function(){var a=this.view.set.paper;this.set=a.set(),this.showOutline&&(this.outline=a.rect(0,0,0,0).attr("stroke","#CFACAC").data("type","outline"),this.set.push(this.outline)),-1!=this.resizers.indexOf("tl")?this.set.push(this.produceResizer("tl").attr("cursor","nwse-resize")):null,-1!=this.resizers.indexOf("t")?this.set.push(this.produceResizer("t").attr("cursor","ns-resize")):null,-1!=this.resizers.indexOf("tr")?this.set.push(this.produceResizer("tr").attr("cursor","nesw-resize")):null,-1!=this.resizers.indexOf("r")?this.set.push(this.produceResizer("r").attr("cursor","ew-resize")):null,-1!=this.resizers.indexOf("br")?this.set.push(this.produceResizer("br").attr("cursor","nwse-resize")):null,-1!=this.resizers.indexOf("b")?this.set.push(this.produceResizer("b").attr("cursor","ns-resize")):null,-1!=this.resizers.indexOf("bl")?this.set.push(this.produceResizer("bl").attr("cursor","nesw-resize")):null,-1!=this.resizers.indexOf("l")?this.set.push(this.produceResizer("l").attr("cursor","ew-resize")):null,this.set.hide(),this.layoutElements()},getEventListeners:function(){var a=this;return{zindexed:function(){a.view.selected&&new Ext.util.DelayedTask(function(){a.set.toFront()}).delay(100)},selected:function(b){a.set.toFront().show()},deselected:function(){a.set.hide()},layout:function(){a.layoutElements()},dragstart:function(){a.set.show().toFront()}}},doDestroy:function(){this.set.remove()},layoutElements:function(){var a=this.view.frame;if(this.outline){var a=this.view.frame;this.outline.attr({x:a.x,y:a.y,width:a.width,height:a.height})}this.set.forEach(function(b){if("resizer"==b.data("type"))switch(b.data("spec")){case"tl":b.attr({x:a.x-3,y:a.y-3});break;case"t":b.attr({x:a.x-3+a.width/2,y:a.y-3});break;case"tr":b.attr({x:a.x-3+a.width,y:a.y-3});break;case"r":b.attr({x:a.x-3+a.width,y:a.y-3+a.height/2});break;case"br":b.attr({x:a.x-3+a.width,y:a.y-3+a.height});break;case"b":b.attr({x:a.x-3+a.width/2,y:a.y-3+a.height});break;case"bl":b.attr({x:a.x-3,y:a.y-3+a.height});break;case"l":b.attr({x:a.x-3,y:a.y-3+a.height/2})}})},produceResizer:function(a){var b=this.view.set.paper,c=this,d=b.rect(0,0,6,6).attr({fill:"white",stroke:"#883333"}).data("type","resizer").data("spec",a).click(function(a){a.stopPropagation()}),e=this.view.ownerCt;return d.mousedown(function(a){a.stopPropagation()}),d.drag(function(a,b){var d=this.obox,f=e.constraint?e.constraintPadding:-9999999,g=f,h=e.constraint?e.paperWidth-d.x-e.constraintPadding:9999999,i=e.constraint?e.paperHeight-d.y-e.constraintPadding:9999999,j={},k=c.view.minW,l=c.view.minH;switch(this.data("spec")){case"tl":var m=d.x+d.width-k,n=d.y+d.height-l,o=Math.max(Math.min(d.x+a,m),f),p=Math.max(Math.min(d.y+b,n),g);j={x:Math.max(o,f),y:Math.max(p,g),width:d.width-o+d.x,height:d.height-p+d.y};break;case"t":var n=d.y+d.height-l,p=Math.max(g,Math.min(d.y+b,n));j={x:d.x,y:p,width:d.width,height:d.height-p+d.y};break;case"tr":var n=d.y+d.height-l,p=Math.max(Math.min(d.y+b,n),g),q=Math.min(Math.max(d.width+a,k),h);j={x:d.x,y:p,width:q,height:d.height-p+d.y};break;case"r":var q=Math.min(Math.max(d.width+a,k),h);j={x:d.x,y:d.y,width:q,height:d.height};break;case"br":var q=Math.min(Math.max(d.width+a,k),h),r=Math.min(Math.max(d.height+b,l),i);j={x:d.x,y:d.y,width:q,height:r};break;case"b":var r=Math.min(Math.max(d.height+b,l),i);j={x:d.x,y:d.y,width:d.width,height:r};break;case"bl":var m=d.x+d.width-k,o=Math.max(Math.min(d.x+a,m),f),r=Math.min(Math.max(d.height+b,l),i);j={x:o,y:d.y,width:d.width-o+d.x,height:r};break;case"l":var m=d.x+d.width-k,o=Math.max(Math.min(d.x+a,m),f);j={x:o,y:d.y,width:d.width-o+d.x,height:d.height}}c.view.layoutInRect(j),c.view.fireEvent("resize",j,this.data("spec"),f,g,h,i)},function(){this.obox=c.view.frame,c.view.fireEvent("resizestart")},function(a){delete this.obox,c.view.fireEvent("resizeend"),GraphicDesigner.suspendClick()}),d}}),Ext.define("GraphicDesigner.RotateDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdrotatedelegate",buildDelegate:function(){},getEventListeners:function(){},doDestroy:function(){}}),Ext.define("GraphicDesigner.ToolboxDelegate",{extend:"GraphicDesigner.ViewDelegate",xtype:"gdtoolboxdelegate",items:[],buildDelegate:function(){var a=this,b=this.view.set.paper;if(!Ext.isEmpty(this.items)){this.toolbox=$('<div class="gd-toolbox"></div>').click(function(a){a.stopPropagation()}).hide(),this.tooltip=$('<div class="gd-toolbox-tooltip"></div>').hide(),this.items.filter(function(b){var c=$('<div class="gd-toolbox-item '+b.icon+'"></div>').hover(function(){a.tooltip.removeClass().addClass("gd-toolbox-tooltip "+b.icon).text(" "+b.title).show()},function(){a.tooltip.hide()}).data("item",b);a.toolbox.append(c),c.click(function(c){b.handler?b.handler(a.view,$(this),c):null,a.layoutElements()})}),$(b.canvas).after(this.toolbox),$(b.canvas).after(this.tooltip);var c=new Ext.util.DelayedTask(function(){a.toolbox.hide()});this.view.on("hover",function(){GraphicDesigner.selecting||($(".gd-toolbox:visible").hide(),c.cancel(),a.layoutElements(),a.toolbox.show())}),this.view.on("unhover",function(){c.delay(200)}),this.toolbox.hover(function(){c.cancel(),a.layoutElements(),a.toolbox.show()},function(){c.delay(200);
})}},getEventListeners:function(){var a=this;return{keymovestart:function(){a.toolbox.hide()},dragmoving:function(){a.toolbox.hide()},dragend:function(){a.layoutElements(),a.toolbox.show()}}},doDestroy:function(){this.tooltip.remove(),this.toolbox.remove()},layoutElements:function(){var a=this.view.frame,b=$(this.view.set.paper.canvas).position();this.tooltip.css({left:a.x+a.width+b.left+3,top:a.y+b.top-20}),this.toolbox.css({left:a.x+a.width+b.left+3,top:a.y+b.top}).show();var c=this;this.toolbox.children().each(function(a,b){b=$(b);var d=b.data("item");d&&d.precondition&&b[d.precondition(c.view)?"show":"hide"]()});var d=this.toolbox.children("*:visible");this.toolbox.removeClass().addClass("gd-toolbox"),1==d.length?this.toolbox.addClass("gd-toolbox-1item"):2==d.length?this.toolbox.addClass("gd-toolbox-2item"):this.toolbox.addClass("gd-toolbox-common")}}),Ext.define("GraphicDesigner.CanvasInfoInspector",{extend:"GraphicDesigner.Inspector",xtype:"gdcanvasinfoinspector",iconCls:"gd-inspector-item-icon gdicon-navigation2",title:"preview",observeTarget:"view",initComponent:function(){this.panelSize={width:220,height:243};var a=this;this.panelConfig={bodyPadding:5,bodyStyle:"background-color:transparent;",html:'<div style="height:100%;padding:5px;" align="center"><canvas class="gd-canvas-preview-canvas"></canvas><div class="gd-splitter-h" style="margin-top:5px;"></div></div>',bbar:{cls:"gd-inspector-panel-toolbar",style:"padding-bottom:8px;",items:["Scale:",{xtype:"numberfield",width:80,style:"margin-left:5px;"},"->",{tooltip:"presentation",iconCls:"gdicon-presentation gd-canvas-preview-btn",style:"margin-right:3px;"},{iconCls:"gdicon-expand gd-canvas-preview-btn"}]},listeners:{afterRender:function(){a.update()}}},this.callParent()},update:function(){var a=this;this.task||(this.task=new Ext.util.DelayedTask(function(){try{var b=$(a.ownerCt.owner.getCanvas()),c=$('<image src="'+a.ownerCt.owner.getDataUrl()+'" />');c.width(b.width()).height(b.height()),$(a.el.dom).append(c);var d=$(a.infoPanel.el.dom).find("canvas");d.attr("width",b.width()).attr("height",b.height());var e=d[0].getContext("2d");e.fillStyle=a.ownerCt.owner.bgColor,e.fillRect(0,0,b.width(),b.height()),e.drawImage(c[0],0,0,b.width(),b.height()),c.remove()}catch(f){}})),this.task.cancel(),this.task.delay(100)}}),Ext.define("GraphicDesigner.FrameInfoInspector",{extend:"GraphicDesigner.Inspector",xtype:"gdframeinfoinspector",iconCls:"gd-inspector-item-icon gdicon-ruler3",title:"Position & Size",labels:["X","Y","W","H"],observeTarget:"view",update:function(a,b,c){var d=this.infoPanel.query("numberfield");-1!=["dragend","selected","resizeend","keymoveend"].indexOf(b)?(this.view=a,d.filter(function(b){switch(b.enable(),b.suspendEvents(!1),b.scope){case"x":b.setValue(a.frame.x);break;case"y":b.setValue(a.frame.y);break;case"w":b.setValue(a.frame.width);break;case"h":b.setValue(a.frame.height)}b.resumeEvents()})):"deselected"==b&&(d.filter(function(a){a.disable()}),delete this.view)},initComponent:function(){var a=this;this.panelSize={width:230,height:110},this.panelConfig={layout:"vbox",defaults:{xtype:"toolbar"},items:[{style:"background-color:transparent;",items:[{xtype:"label",html:this.labels[0],style:"width:20px;"},{xtype:"gdsymbolnumberfield",symbol:"px",step:1,scope:"x",value:0,width:80,enableKeyEvents:!0,updateView:function(){a.view&&(a.view.frame.x=this.getValue(),a.view.layoutInRect(a.view.frame),a.view.fireEvent("keymoveend"))},listeners:{blur:function(){this.updateView()},keyup:function(a,b){13==b.keyCode&&this.updateView()}}},{xtype:"label",html:this.labels[2],style:"width:20px;margin-left:10px;"},{xtype:"gdsymbolnumberfield",symbol:"px",step:1,scope:"w",value:20,width:80,enableKeyEvents:!0,updateView:function(){if(a.view){var b=a.ownerCt.owner;a.view.frame.width=this.getValue(),b.constraint&&(a.view.frame.width=Math.min(a.view.frame.width,b.paperWidth-b.constraintPadding-b.constraintPadding-a.view.frame.x)),a.view.layoutInRect(a.view.frame),a.view.fireEvent("resizeend")}},listeners:{blur:function(){this.updateView()},keyup:function(a,b){13==b.keyCode&&this.updateView()}}}]},{style:"background-color:transparent;",items:[{xtype:"label",html:this.labels[1],style:"width:20px;"},{xtype:"gdsymbolnumberfield",symbol:"px",step:1,scope:"y",value:0,width:80,enableKeyEvents:!0,updateView:function(){a.view&&(a.view.frame.y=this.getValue(),a.view.layoutInRect(a.view.frame),a.view.fireEvent("keymoveend"))},listeners:{blur:function(){this.updateView()},keyup:function(a,b){13==b.keyCode&&this.updateView()}}},{xtype:"label",html:this.labels[3],style:"width:20px;margin-left:10px;"},{xtype:"gdsymbolnumberfield",symbol:"px",step:1,scope:"h",value:20,width:80,enableKeyEvents:!0,updateView:function(){if(a.view){var b=a.ownerCt.owner;a.view.frame.height=this.getValue(),b.constraint&&(a.view.frame.height=Math.min(a.view.frame.height,b.paperHeight-b.constraintPadding-b.constraintPadding-a.view.frame.y)),a.view.layoutInRect(a.view.frame),a.view.fireEvent("resizeend")}},listeners:{blur:function(){this.updateView()},keyup:function(a,b){13==b.keyCode&&this.updateView()}}}]}],listeners:{afterRender:function(){a.update(null,"deselected")}}},this.callParent()}}),Ext.define("GraphicDesigner.Circle",{extend:"GraphicDesigner.View",xtype:"gdcircle",getDefaultFrame:function(){return{x:50,y:50,width:80,height:80}},getPreview:function(a){var b=GraphicDesigner.getCenter(a);return[{type:"circle",fill:"white",cx:b.x-2,cy:b.y-2,r:Math.min(a.width,a.height)/2}]},redraw:function(){var a=this.frame;this.set[0].attr({cx:a.x+a.width/2,cy:a.y+a.height/2,rx:a.width/2,ry:a.height/2})},buildUI:function(a){this.shapes=[{type:"ellipse","stroke-width":2}],this.callParent(arguments)},afterViewBuilt:function(){this.labelDelegate=Ext.applyIf(Ext.clone(this.labelDelegate),{xtype:"gdlabeldelegate",text:this.text,getTextRect:function(){return this.view.frame}}),this.resizeDelegate=Ext.applyIf(Ext.clone(this.resizeDelegate),{xtype:"gdresizedelegate",showOutline:!0,resizers:["tl","tr","bl","br"]})}}),Ext.define("GraphicDesigner.Rect",{extend:"GraphicDesigner.View",xtype:"gdrect",getDefaultFrame:function(){return{x:50,y:50,width:100,height:100}},getPreview:function(a){return[{type:"rect",fill:"white",x:a.x,y:a.y,width:a.width-4,height:a.height-4}]},redraw:function(){this.set[0].attr(this.frame)},buildUI:function(a){this.shapes=[{type:"rect","stroke-width":2}],this.callParent(arguments)},afterViewBuilt:function(){console.log(this.labelDelegate),this.labelDelegate=Ext.applyIf(Ext.clone(this.labelDelegate),{xtype:"gdlabeldelegate",text:this.text,getTextRect:function(){return this.view.frame}}),this.resizeDelegate=Ext.applyIf(Ext.clone(this.resizeDelegate),{xtype:"gdresizedelegate",resizers:["tl","tr","bl","br"],showOutline:!1})}}),Ext.define("GraphicDesigner.Image",{extend:"GraphicDesigner.View",xtype:"gdimage",src:null,setSrc:function(a){this.set[0].attr("src",a)},getDefaultFrame:function(){return{x:50,y:50,width:100,height:100}},getPreview:function(a){return[{type:"image",x:a.x,y:a.y,width:a.width-4,height:a.height-4}]},redraw:function(){this.set[0].attr(this.frame)},buildUI:function(a){this.shapes=[{type:"image"}],this.callParent(arguments)},afterViewBuilt:function(){this.labelDelegate=Ext.applyIf(Ext.clone(this.labelDelegate),{xtype:"gdlabeldelegate",text:this.text,getTextRect:function(){return this.view.frame}}),this.resizeDelegate=Ext.applyIf(Ext.clone(this.resizeDelegate),{xtype:"gdresizedelegate",resizers:["tl","tr","bl","br"],showOutline:!0})}}),Ext.define("GraphicDesigner.Pool",{extend:"GraphicDesigner.View",xtype:"gdpool",minH:90,getPreview:function(a){var b=Math.min(a.height,a.width),c=a.height-4;b>=c&&(b=.6*c);var d=a.x+(a.width-b)/2,e=c/4;return[{type:"rect",x:d,y:a.y,width:b,height:c},{type:"path",path:"M"+d+","+(a.y+e)+"H"+(d+b)}]},getDefaultFrame:function(){return{x:50,y:50,width:200,height:400}},redraw:function(){var a=this.frame;this.set[0].attr({x:a.x,y:a.y,width:a.width,height:40}),this.set[1].attr(a),this.set[2].attr({path:["M",a.x,a.y+40,"L",a.x+a.width,a.y+40].join(",")})},updateStyle:function(){this.set.attr({opacity:this.style.opacity}),this.set[0].attr({fill:this.style.fill,"fill-opacity":this.style.fillOpacity}),this.set[1].attr({"stroke-width":this.style.lineWidth,stroke:this.style.lineColor,"stroke-dasharray":this.style.lineStyle}),this.set[2].attr({"stroke-width":this.style.lineWidth,stroke:this.style.lineColor,"stroke-dasharray":this.style.lineStyle})},buildUI:function(a){this.shapes=[{type:"rect","stroke-width":0},{type:"rect","stroke-width":2},{type:"path","stroke-width":2}],this.callParent(arguments)},afterViewBuilt:function(){this.labelDelegate=Ext.applyIf(Ext.clone(this.labelDelegate),{xtype:"gdlabeldelegate",text:this.text,getTextRect:function(){var a=this.view.frame;return{x:a.x,y:a.y,width:a.width,height:40}}}),this.linkDelegate=null,this.rotateDelegate=null,this.resizeDelegate=Ext.applyIf(Ext.clone(this.resizeDelegate),{xtype:"gdresizedelegate",showOutline:!1});var a=this;this.dockDelegate=Ext.applyIf(Ext.clone(this.dockDelegate),{xtype:"gddockdelegate",getOtherDockers:function(){return[{spec:"y",dir:"t",getValue:function(){return a.frame.y+40},docked:function(a,b){b.y=a.getValue()-40},dock:function(b,c){"t"==b.dir?c.y=a.frame.y+40:"b"==b.dir&&(c.y=a.frame.y-c.height+40)}}]}})}}),Ext.define("GraphicDesigner.HPool",{extend:"GraphicDesigner.Pool",xtype:"gdhpool",minW:90,getPreview:function(a){var b=Math.min(a.height,a.width)-4,c=a.height;c>=b&&(c=.6*b);var d=b/4,e=a.x+(a.width-b)/2,f=a.y+(a.height-c)/2;return[{type:"rect",x:e,y:f,width:b,height:c},{type:"path",path:"M"+(e+d)+","+f+"V"+(f+c)}]},getDefaultFrame:function(){return{x:50,y:50,width:400,height:200}},redraw:function(){var a=this.frame;this.set[0].attr({x:a.x,y:a.y,width:40,height:a.height}),this.set[1].attr(a),this.set[2].attr({path:["M",a.x+40,a.y,"L",a.x+40,a.y+a.height].join(",")})},buildUI:function(a){this.shapes=[{type:"rect","stroke-width":0},{type:"rect","stroke-width":2},{type:"path","stroke-width":2}],this.callParent(arguments)},afterViewBuilt:function(){this.labelDelegate=Ext.applyIf(Ext.clone(this.labelDelegate),{xtype:"gdlabeldelegate",text:this.text,getTransform:function(){var a=this.view.frame;return{angle:-90,cx:a.x+a.width/2,cy:a.y+a.height/2}},getTextRect:function(){var a=this.view.frame,b=GraphicDesigner.getCenter(a);return{x:b.x-a.height/2,y:b.y-a.width/2,width:a.height,height:40}}}),this.rotateDelegate=null,this.linkDelegate=null,this.resizeDelegate=Ext.applyIf(Ext.clone(this.resizeDelegate),{xtype:"gdresizedelegate",showOutline:!1});var a=this;this.dockDelegate=Ext.applyIf(Ext.clone(this.dockDelegate),{xtype:"gddockdelegate",getOtherDockers:function(){return[{spec:"x",dir:"l",getValue:function(){return a.frame.x+40},docked:function(a,b){b.x=a.getValue()-40},dock:function(b,c){"l"==b.dir?c.x=a.frame.x+40:"r"==b.dir&&(c.x=a.frame.x-c.width+40)}}]}})}});
//# sourceMappingURL=GraphicDesigner.min.js.map